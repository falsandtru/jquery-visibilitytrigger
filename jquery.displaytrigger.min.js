/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.4.6
 * @updated 2013/08/25
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(d){var p=window,D=document,y=void 0,t=["settings"];d.fn.displaytrigger=d.displaytrigger=function(B){function E(e){for(var a=0,c;c=e.context[a];a++)e.id=t.length,e.height.window=0,e.height.element=0,t.push(d.extend(!0,{},e)),d(c).unbind(e.nss.displaytrigger).bind(e.nss.displaytrigger,e.id,function(a,b,e){var f=t[a.data],g,c=this,h=arguments.callee;if(f){if(f.delay&&b){for(;g=f.queue.shift();)clearTimeout(g);g=setTimeout(function(){if(f){for(;g=f.queue.shift();)clearTimeout(g);C(a,f,c,b||
p)}},f.delay);f.queue.push(g)}else C(a,f,c,b||p);f.suspend&&!e&&(d(this).unbind(f.nss.displaytrigger),setTimeout(function(){f&&d(this).bind(f.nss.displaytrigger,f.id,h).trigger(f.nss.displaytrigger,[b,!0])},f.suspend))}}),d.data(c,e.nss.data,!0),d(c).unbind(e.nss.scroll).bind(e.nss.scroll,e.id,function(a){(a=t[a.data])&&d(this).trigger(a.nss.displaytrigger,[this])}).unbind(e.nss.resize).bind(e.nss.resize,e.id,function(a){(a=t[a.data])&&d(this).trigger(a.nss.displaytrigger,[this])}),0===a&&d(p).filter(function(){return!e.window&&
e.expand}).unbind(e.nss.scroll).bind(e.nss.scroll,e.id,function(a){(a=t[a.data])&&a.context.trigger(a.nss.displaytrigger,[this])}).unbind(e.nss.resize).bind(e.nss.resize,e.id,function(a){(a=t[a.data])&&a.context.trigger(a.nss.displaytrigger,[this])})}function C(e,a,c,h){var b=a.validate?a.validate.clone({name:"jquery.displaytrigger.js - drive()"}):!1;b&&b.start();b&&(b.scope=function(a){return eval(a)});b&&b.test("++",1,[a,window===h],"drive()");b&&b.test("++",1,0,"initialize");var p=window,f=document,
f=a.window?f:c,g=!1,l=d(a.trigger,f),q=l.eq(a.index),r=d(h).scrollTop(),k=a.height[h===p?"window":"element"],u=r===k?a.direction:r<k?-1:1,k=Math.abs(r-k);b&&b.test("++",1,0,"setting");a.direction!==u&&(a.turn=!0,a.end=!1,a.direction=u,a.index=0>a.index?0:l.length<=a.index?l.length-1:a.index,q=l.eq(a.index));a.distance=0===k?a.distance:k;a.height[h===p?"window":"element"]=r;a.end=q[0]?!1:a.end;-1===a.direction&&a.length<l.length&&(a.turn=!1,a.end=!1);a.length=l.length;b&&b.test("++",1,a,"switch");
switch(!0){case !l.length:b&&b.test("*",1,0,"case !targets.length");break;case 0===a.step&&!q[0]:b&&b.test("*",1,0,"case settings.step === 0 && !target[ 0 ]");a.index+=-1;b&&b.end();return;case 0>a.index:b&&b.test("*",1,0,"case settings.index < 0");a.index=0;a.end=!0;break;case l.length<=a.index:b&&b.test("*",1,0,"case targets.length <= settings.index");a.index=l.length-1;a.end=!0;break;case a.beforehand>a.index&&(a.multi||!a.skip||!d.data(q[0],a.nss.data+"-fired")):b&&b.test("*",1,0,"case settings.beforehand > settings.index &&");
a.beforehand===a.index+1&&(a.beforehand=0);g=!0;break;default:b&&b.test("*",1,0,"default");if(a.end||q.is(":hidden")||!a.multi&&a.skip&&d.data(q[0],a.nss.data+"-fired"))break;b&&b.test("++",1,0,"initialize");var n=d(p),r=n.scrollTop(),u=n.outerHeight(!0),n=d(c),w=a.window?0:n.offset().top,v=n.outerHeight(!0),k=q.offset().top,x=q.outerHeight(!0),n=Math.max(0,a.direction),z=-1<=a.ahead[0]&&1>=a.ahead[0]?parseInt(u*a.ahead[0]):parseInt(a.ahead[0]),A=-1<=a.ahead[1]&&1>=a.ahead[1]?parseInt(u*a.ahead[1]):
parseInt(a.ahead[1]),n=n?A:z,m,s;b&&b.test("++",1,a.mode,"check");switch(a.mode){case "border":g=r+(1===a.direction?-n:u+n);m=g>=k;s=g<=k+x;b&&b.test("++",1,[g,m,s],"border");g=a.turn&&(1===a.direction?g-a.distance>k:g+a.distance<k+x)?!1:a.skip?m&&s:1===a.direction?m:s;break;case "toggle":b&&b.test("++",1,[],"toggle");break;case "hide":b&&b.test("++",1,[],"hide");break;default:m=u+r>=k-A&&(a.window?!0:w+v>=k-A),g=a.window?!1:m&&w>k+x+z,s=r<=k+x+z&&(a.window?!0:w<=k+x+z),w=a.window?!1:s&&w+v<k-A,b&&
b.test("++",1,[m,g,s,w],"show"),g=a.turn&&a.multi&&(1===a.direction?r-a.distance+u>k-n:r+a.distance<k+x+n)?!1:a.skip?m&&s:1===a.direction?m&&!g:s&&!w&&a.multi}}b&&b.test("/",1,g,"fire");g&&(!a.multi&&++a.count&&a.skip&&d.data(q[0],a.nss.data+"-fired",!0),a.callback.apply(q[0],[e,a.parameter,{index:a.index,length:l.length,direction:a.direction}]));b&&b.test("++",1,0,"terminate");if(!l.length||a.terminate&&!a.multi&&0!==a.step&&a.count>=l.length){m=0;b&&b.test("*",1,0,"unbind node event");d(c).unbind(a.nss.displaytrigger).unbind(a.nss.scroll).unbind(a.nss.resize);
b&&b.test("++",1,0,"remove data");d.removeData(f,a.nss.data);!a.multi&&a.skip&&l.removeData(a.nss.data+"-fired");for(f=0;l=a.context[f];f++)m+=d.data(l,a.nss.data)?1:0;b&&b.test("++",1,0,"unbind root event");!m&&!a.window&&a.expand&&d(p).unbind(a.nss.scroll).unbind(a.nss.resize);b&&b.end();return t[a.id]=y}b&&b.test("++",1,0,"exit");if(!a.end&&!g&&isFinite(n)&&(1===a.direction?!m:!s))return b&&b.end(),a.turn=!1;b&&b.test("++",1,0,"increment");a.index+=0!==a.step||g?0===a.step&&-1===a.direction?a.direction:
a.step*a.direction:a.direction;b&&b.end();a.end||arguments.callee.apply(this,arguments)}if("function"===typeof this)return arguments.callee.apply(d(p),arguments);var h=window.validator instanceof Object?window.validator.clone({name:"jquery.displaytrigger.js",base:!0}):!1;h&&h.start();h&&h.test("++",1,B,"displaytrigger()");h&&h.test("++",1,0,"initialize");var c=d.extend(!0,{},{id:0,gns:"displaytrigger",ns:y,trigger:y,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,expand:!0,
delay:300,suspend:-100,mode:"show",terminate:!0},B),v=[c.gns].concat(c.ns||[]);h&&h.test("++",1,0,"overwrite");d.extend(!0,c,{nss:{displaytrigger:v.join("."),scroll:["scroll"].concat(v.join(":")).join("."),resize:["resize"].concat(v.join(":")).join("."),data:v.join(":"),array:v},window:this[0]===p,context:this,scope:this[0]===p?d(D):d(this),ahead:typeof c.ahead in{string:0,number:0}?[c.ahead,c.ahead]:y,suspend:1<=c.suspend?c.suspend:0<=c.suspend?parseInt(c.delay*c.suspend):Math.max(0,c.delay+c.suspend),
index:0,length:0,count:0,height:{},direction:1,distance:0,turn:!1,end:!1,queue:[],options:B,validate:h});h&&h.test("++",1,0,"register");c.scope.length&&(c.scope.find(c.trigger).length&&arguments.length)&&E(c);h&&h.end();return this}})(jQuery);
