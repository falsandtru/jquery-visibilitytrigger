/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.1.7
 * @updated 2013/04/16
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function k(k){function v(c,b,d){var e=window,a=document,j=b===e?a:b,n=!1,g,l;if(a=f[c.data]){g=jQuery(a.trigger,j);l=g.eq(a.index);switch(!0){case !g.length:break;case a.terminate&&(0>a.index||a.index>=g.length):break;case 0>a.index:return a.index=0,a.end=!0,f[a.id]=a,arguments.callee.apply(b,arguments);case a.index>=g.length:return a.index=g.length-1,a.end=!0,f[a.id]=a,arguments.callee.apply(b,arguments);case a.beforehand>a.index&&!jQuery.data(l[0],a.nss.data+"-fired"):n=!0;break;default:var m=
jQuery(d).scrollTop(),h=a.height[d===e?"window":"element"],k=m===h?a.direction:m<h?-1:1,h=-1===k?h-m:m-h;a.direction!==k&&(a.turn=!0,a.end=!1,a.direction=k,l=g.eq(a.index));a.distance=0===h?a.distance:h;a.height[d===e?"window":"element"]=m;if(a.end)break;var m=jQuery(e).scrollTop(),h=l.offset().top,q=jQuery(e).height(),p=l.height(),s=-1<a.ahead&&1>a.ahead?p*a.ahead:a.ahead,t=m>=h-q-s,u=m<=h+p+s;if(!a.once||!jQuery.data(l[0],a.nss.data+"-fired"))n=a.turn&&!a.once&&(-1===k?m+a.distance<=h+p+s:m-a.distance>=
h-q-s)?!1:a.skip?t&&u:-1===k?u:t;if(!n&&!(-1===a.direction?u:t)){a.turn=!1;f[a.id]=a;return}}n&&l[0]!==r&&(jQuery.data(l[0],a.nss.data+"-fired",!0),a.count+=1,a.callback.apply(l[0],[c,a.parameter,{index:a.index,direction:a.direction}]));if(a.terminate&&n&&(0!==a.step&&a.count>=g.length||0<a.step&&!a.skip&&a.index===g.length-1||0>a.step&&!a.skip&&0===a.index)||!g.length||l[0]===r){n=0;jQuery(b).unbind(a.nss.displaytrigger);jQuery(d).unbind(a.nss.scroll).unbind(a.nss.resize);jQuery.removeData(j,a.nss.data);
for(j=0;g=a.scope[j];j++)n+=jQuery.data(g,a.nss.data)?1:0;n||d===e?null:jQuery(e).unbind(a.nss.scroll).unbind(a.nss.resize);f[a.id]=r}else return a.index+=-1===a.direction?-a.step:a.step,f[a.id]=a,a.end?r:arguments.callee.apply(b,arguments)}}if("function"===typeof this)return arguments.callee.apply(jQuery(j),arguments);var c=jQuery.extend(!0,{},{id:0,gns:"displaytrigger",ns:r,trigger:r,callback:function(){},parameter:[],ahead:0,beforehand:0,index:0,step:1,once:!0,skip:!1,expand:!0,delay:300,terminate:!0,
reset:!0},k);c.reset&&jQuery.extend(!0,c,{nss:{scroll:["scroll",c.gns+(c.ns?":"+c.ns:"")].join("."),displaytrigger:""+(c.gns+(c.ns?"."+c.ns:"")),resize:["resize",c.gns+(c.ns?":"+c.ns:"")].join("."),data:c.gns+(c.ns?":"+c.ns:"")},scope:this[0]===j?jQuery(p):jQuery(this),index:0,count:0,height:{},direction:1,distance:0,turn:!1,end:!1,reset:!1,queue:[]});if(!c.scope.length||!c.scope.find(c.trigger).length||!arguments.length)return this;for(var b=c,c=b.height.window=0,q;q=b.scope[c];c++)b.height.element=
0,b.id=f.length,f.push(jQuery.extend(!0,{},b)),jQuery.data(q,b.nss.data,b.id),jQuery(q===p?j:q).unbind(b.nss.scroll).bind(b.nss.scroll,b.id,function(b){b=f[b.data];jQuery(this).trigger(b.nss.displaytrigger,[this])}).unbind(b.nss.displaytrigger).bind(b.nss.displaytrigger,b.id,function(b,c){var d=f[b.data],e,a;for(a=this;e=d.queue.shift();)clearTimeout(e);d.delay?(e=setTimeout(function(){for(;e=d.queue.shift();)clearTimeout(e);f[d.id]=d;v(b,a,c||j)},d.delay),d.queue.push(e),f[d.id]=d):v(b,a,c||j)});
jQuery(j).unbind(b.nss.resize).bind(b.nss.resize,b.id,function(b){b=f[b.data];b.scope.trigger(b.nss.displaytrigger,[this])}).filter(function(){return b.expand&&p!==b.scope[0]}).unbind(b.nss.scroll).bind(b.nss.scroll,b.id,function(b){b=f[b.data];b.scope.trigger(b.nss.displaytrigger,[this])});return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var r=void 0,j=window,p=document,f=["settings"];jQuery.fn.displaytrigger=k;jQuery.displaytrigger=k;k=null}})();
