/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.0.2
 * @updated 2013/04/10
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @CodingConventions Google JavaScript Style Guide
 * @Compressor YUI Compressor
 */
(function(b){jQuery.fn.displaytrigger=a;jQuery.displaytrigger=a;a=null;function a(c){if(typeof this==="function"){return arguments.callee.apply(jQuery(window),arguments)}var j=window,h=document,g={gns:"displaytrigger",ns:undefined,trigger:undefined,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,once:true,skip:false,expand:true,terminate:true,reset:true},f=jQuery.extend(true,{},g,c);if(f.reset){jQuery.extend(true,f,{nss:{scroll:["scroll",f.gns+(f.ns?":"+f.ns:"")].join("."),displaytrigger:[f.gns+(f.ns?"."+f.ns:"")].join("."),resize:["resize",f.gns+(f.ns?":"+f.ns:"")].join("."),data:f.gns+(f.ns?":"+f.ns:"")},scope:this.get(0)===j?jQuery(h):this,index:0,height:{},direction:"down",distance:0,turn:false,end:false,reset:false,})}if(!f.scope.length||!f.scope.find(f.trigger).length||!arguments.length){return this}f.height.window=0;for(var e=0,d;d=f.scope[e];e++){f.height.element=0;jQuery.data(d,f.nss.data,jQuery.extend(true,{},f))}jQuery(j).unbind(f.nss.resize).bind(f.nss.resize,f,function(i){i.data.scope.trigger(i.data.nss.displaytrigger,[this])}).filter(function(){return f.expand&&h!==f.scope.get(0)}).unbind(f.nss.scroll).bind(f.nss.scroll,f,function(i){i.data.scope.trigger(i.data.nss.displaytrigger,[this])});jQuery(this).unbind(f.nss.scroll).bind(f.nss.scroll,f,function(i){jQuery(this).trigger(i.data.nss.displaytrigger,[this])}).unbind(f.nss.displaytrigger).bind(f.nss.displaytrigger,f,function(x,m){var o=window,G=document,A=this===o?G:this,E=false,D,F,B=jQuery.data(A,x.data.nss.data);if(!B){return this}m=m||o;D=jQuery(B.trigger,A);F=D.eq(B.index);switch(true){case !D.length:break;case B.terminate&&B.index>=D.length:break;case B.index<0:B.index=0;B.end=true;jQuery.data(A,B.nss.data,B);return arguments.callee.apply(this,arguments);case B.index>=D.length:B.index=D.length-1;B.end=true;jQuery.data(A,B.nss.data,B);return arguments.callee.apply(this,arguments);case B.beforehand>B.index&&!jQuery.data(F.get(0),B.nss.data+"-fired"):E=true;break;default:var p=jQuery(m).scrollTop(),u=B.height[m===o?"window":"element"],C=p===u?B.direction:p<u?"up":"down",n=C==="up"?u-p:p-u;TURN:{if(B.direction===C){break TURN}B.turn=true;B.end=false;B.direction=C;F=D.eq(B.index)}B.distance=n===0?B.distance:n;B.height[m===o?"window":"element"]=p;if(B.end){break}var w=jQuery(o).scrollTop(),s=F.offset().top,r=jQuery(o).height(),q=F.height(),l=-1<B.ahead&&B.ahead<1?q*B.ahead:B.ahead,t=w>=s-r-l,z=w<=s+q+l;FIRE:{if(B.once&&jQuery.data(F.get(0),B.nss.data+"-fired")){break FIRE}E=B.turn&&!B.once&&(C==="up"?w+B.distance<=s+q+l:w-B.distance>=s-r-l)?false:(B.skip?t&&z:C==="up"?z:t)}END:{if(E||(B.direction==="up"?z:t)){break END}B.turn=false;jQuery.data(A,B.nss.data,B);return this}break}if(B.terminate&&(!F.length||!D.length)){var v=0;jQuery(this).unbind(B.nss.displaytrigger).unbind(B.nss.scroll);jQuery.removeData(A,B.nss.data);for(var y=0,k;k=B.scope[y];y++){v+=jQuery.data(k,B.nss.data)?1:0}v?null:jQuery(o).unbind(B.nss.scroll);B.scope=null;o=G=A=null;return this}if(B.step===0&&F.get(0)===jQuery.data(A,B.nss.data+"-last")){jQuery.data(A,B.nss.data+"-last",null);return this}if(B.step===0){jQuery.data(A,B.nss.data+"-last",F.get(0))}if(E){jQuery.data(F.get(0),B.nss.data+"-fired",true);B.callback.apply(F.get(0),[x,B.parameter,B.index,B.direction])}B.index+=B.direction==="up"?-B.step:B.step;jQuery.data(A,B.nss.data,B);o=G=A=null;return B.end?this:arguments.callee.apply(this,arguments)});j=h=null;return this}})(jQuery);
