/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.1.9
 * @updated 2013/04/18
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor Closure Compiler
 */
(function(){function j(j){function v(c,b,e){var f=window,a=document,g=b===f?a:b,n=!1,k,l;if(a=d[c.data]){k=jQuery(a.trigger,g);l=k.eq(a.index);switch(!0){case !k.length:break;case 0===a.step&&!l[0]:a.index+=-1;d[a.id]=a;return;case 0>a.index:return a.index=0,a.end=!0,d[a.id]=a,arguments.callee.apply(b,arguments);case a.index>=k.length:return a.index=k.length-1,a.end=!0,d[a.id]=a,arguments.callee.apply(b,arguments);case a.beforehand>a.index&&!jQuery.data(l[0],a.nss.data+"-fired"):n=!0;break;default:var m=
jQuery(e).scrollTop(),h=a.height[e===f?"window":"element"],j=m===h?a.direction:m<h?-1:1,h=-1===j?h-m:m-h;a.direction!==j&&(a.turn=!0,a.end=!1,a.direction=j,l=k.eq(a.index));a.distance=0===h?a.distance:h;a.height[e===f?"window":"element"]=m;if(a.end)break;var m=jQuery(f).scrollTop(),h=l.offset().top,p=jQuery(f).height(),s=l.height(),r=-1<=a.ahead&&1>=a.ahead?parseInt(s*a.ahead):a.ahead,t=m>=h-p-r,u=m<=h+s+r;if(!a.once||!jQuery.data(l[0],a.nss.data+"-fired"))n=a.turn&&!a.once&&(-1===j?m+a.distance<=
h+s+r:m-a.distance>=h-p-r)?!1:a.skip?t&&u:-1===j?u:t;if(!n&&!(-1===a.direction?u:t)){a.turn=!1;d[a.id]=a;return}}n&&l[0]!==q&&(jQuery.data(l[0],a.nss.data+"-fired",!0),a.count+=1,a.callback.apply(l[0],[c,a.parameter,{index:a.index,direction:a.direction}]));if(!k.length||a.terminate&&a.once&&0!==a.step&&a.count>=k.length){n=0;jQuery(b).unbind(a.nss.displaytrigger);jQuery(e).unbind(a.nss.scroll).unbind(a.nss.resize);jQuery.removeData(g,a.nss.data);for(g=0;k=a.context[g];g++)n+=jQuery.data(k,a.nss.data)?
1:0;n||a.context[0]===f?null:jQuery(f).unbind(a.nss.scroll).unbind(a.nss.resize);d[a.id]=q}else return a.index+=0===a.step&&!n?a.direction:0===a.step&&-1===a.direction?a.direction:a.step*a.direction,d[a.id]=a,a.end?q:arguments.callee.apply(b,arguments)}}if("function"===typeof this)return arguments.callee.apply(jQuery(g),arguments);var c=jQuery.extend(!0,{},{id:0,gns:"displaytrigger",ns:q,trigger:q,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!0,skip:!1,expand:!0,delay:300,
terminate:!0,reset:!0},j);c.reset&&jQuery.extend(!0,c,{nss:{scroll:["scroll",c.gns+(c.ns?":"+c.ns:"")].join("."),displaytrigger:""+(c.gns+(c.ns?"."+c.ns:"")),resize:["resize",c.gns+(c.ns?":"+c.ns:"")].join("."),data:c.gns+(c.ns?":"+c.ns:"")},context:this,scope:this[0]===g?jQuery(w):jQuery(this),once:c.multi?!1:!0,index:0,count:0,height:{},direction:1,distance:0,turn:!1,end:!1,reset:!1,called:!1,queue:[]});if(!c.scope.length||!c.scope.find(c.trigger).length||!arguments.length)return this;for(var b=
c,c=0,p;p=b.context[c];c++)b.id=d.length,b.height.window=0,b.height.element=0,d.push(jQuery.extend(!0,{},b)),jQuery(p).unbind(b.nss.displaytrigger).bind(b.nss.displaytrigger,b.id,function(b,c){var e=d[b.data],f,a=this;if(!e.delay||!e.called)e.called=!0,v(b,a,c||g);else{for(;f=d[e.id].queue.shift();)clearTimeout(f);f=setTimeout(function(){if(d[e.id]){for(;f=d[e.id].queue.shift();)clearTimeout(f);d[e.id]=e;v(b,a,c||g)}},e.delay);d[e.id].queue.push(f)}}),jQuery.data(p,b.nss.data,!0),jQuery(p).unbind(b.nss.scroll).bind(b.nss.scroll,
b.id,function(b){jQuery(this).trigger(d[b.data].nss.displaytrigger,[this])}),0===c&&jQuery(g).filter(function(){return b.context[0]===g||b.expand}).unbind(b.nss.resize).bind(b.nss.resize,b.id,function(c){b.context.trigger(d[c.data].nss.displaytrigger,[this])}).filter(function(){return b.context[0]!==g}).unbind(b.nss.scroll).bind(b.nss.scroll,b.id,function(c){b.context.trigger(d[c.data].nss.displaytrigger,[this])});return this}if("undefined"!==typeof window.jQuery){jQuery=window.jQuery;var q=void 0,
g=window,w=document,d=["settings"];jQuery.fn.displaytrigger=j;jQuery.displaytrigger=j;j=null}})();
