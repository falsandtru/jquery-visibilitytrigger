/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.0.1
 * @updated 2013/04/07
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @CodingConventions Google JavaScript Style Guide
 * @Compressor YUI Compressor
 */
(function(b){jQuery.fn.displaytrigger=a;jQuery.displaytrigger=a;a=null;function a(c){if(typeof this==="function"){return arguments.callee.apply(jQuery(window),arguments)}var j=window,h=document,g={gns:"displaytrigger",ns:undefined,trigger:undefined,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,once:true,skip:false,expand:true,terminate:true,reset:true},f=jQuery.extend(true,{},g,c);if(f.reset){jQuery.extend(true,f,{nss:{scroll:["scroll",f.gns+(f.ns?":"+f.ns:"")].join("."),displaytrigger:[f.gns+(f.ns?"."+f.ns:"")].join("."),resize:["resize",f.gns+(f.ns?":"+f.ns:"")].join("."),data:f.gns+(f.ns?":"+f.ns:"")},scope:this.get(0)===j?jQuery(h):this,index:0,height:{},direction:"down",distance:0,turn:false,end:false,reset:false,})}if(!f.scope.length||!f.scope.find(f.trigger).length||!arguments.length){return this}f.height.window=0;for(var e=0,d;d=f.scope[e];e++){f.height.element=0;jQuery.data(d,f.nss.data,jQuery.extend(true,{},f))}jQuery(j).unbind(f.nss.resize).bind(f.nss.resize,f,function(i){i.data.scope.get(0)===document?null:jQuery(window).trigger(i.data.nss.displaytrigger,[this])}).filter(function(){return f.expand&&h!==f.scope.get(0)}).unbind(f.nss.scroll).bind(f.nss.scroll,f,function(i){i.data.scope.trigger(i.data.nss.displaytrigger,[this])});jQuery(this).unbind(f.nss.scroll).bind(f.nss.scroll,f,function(i){jQuery(this).trigger(i.data.nss.displaytrigger,[this])}).unbind(f.nss.displaytrigger).bind(f.nss.displaytrigger,f,function(x,m){var o=window,E=document,A=this===o?E:this,D,B=jQuery.data(A,x.data.nss.data);if(!B){return this}m=m||o;targets=jQuery(B.trigger,A);target=targets.eq(B.index);switch(true){case !targets.length:D=false;break;case B.terminate&&B.index>=targets.length:D=false;break;case B.index<0:B.index=0;B.end=true;jQuery.data(A,B.nss.data,B);return arguments.callee.apply(this,arguments);case B.index>=targets.length:B.index=targets.length-1;B.end=true;jQuery.data(A,B.nss.data,B);return arguments.callee.apply(this,arguments);case B.once&&jQuery.data(target.get(0),B.nss.data+".fired"):D=false;break;case B.beforehand>B.index&&!jQuery.data(target.get(0),B.nss.data+".fired"):D=true;break;case B.once:var w=jQuery(o).scrollTop(),s=target.offset().top,r=jQuery(o).height(),q=target.height(),l=-1<B.ahead&&B.ahead<1?q*B.ahead:B.ahead,t=w>=s-r-l,z=w<=s+q+l;D=(B.skip?t&&z:t)&&!jQuery.data(target.get(0),B.nss.data+".fired")?true:false;END:{if(D||t){break END}jQuery.data(A,B.nss.data,B);return this}break;default:var p=jQuery(m).scrollTop(),u=B.height[m===o?"window":"element"],C=p===u?B.direction:p<u?"up":"down",n=C==="up"?u-p:p-u;TURN:{if(B.direction===C){break TURN}B.turn=true;B.end=false;B.direction=C;target=targets.eq(B.index)}B.distance=n===0?B.distance:n;B.height[m===o?"window":"element"]=p;if(B.end){break}var w=jQuery(o).scrollTop(),s=target.offset().top,r=jQuery(o).height(),q=target.height(),l=-1<B.ahead&&B.ahead<1?q*B.ahead:B.ahead,t=w>=s-r-l,z=w<=s+q+l;D=B.turn&&(C==="up"?w+B.distance<=s+q+l:w-B.distance>=s-r-l)?false:(B.skip?t&&z:C==="up"?z:t);END:{if(D||(B.direction==="up"?z:t)){break END}B.turn=false;jQuery.data(A,B.nss.data,B);return this}break}if(B.terminate&&!target.length){var v=0;jQuery(this).unbind(B.nss.displaytrigger).unbind(B.nss.scroll);jQuery.removeData(A,B.nss.data);for(var y=0,k;k=B.scope[y];y++){v+=jQuery.data(k,B.nss.data)?1:0}v?null:jQuery(o).unbind(B.nss.scroll);B.scope=null;o=E=A=null;return this}if(D){jQuery.data(target.get(0),B.nss.data+".fired",true);B.callback.apply(target.get(0),[x,B.parameter,B.index,B.direction])}B.index+=B.once?B.step:B.direction==="up"?-B.step:B.step;jQuery.data(A,B.nss.data,B);o=E=A=null;return B.end?this:arguments.callee.apply(this,arguments)});j=h=null;return this}})(jQuery);
