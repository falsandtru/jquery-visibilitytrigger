/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.4.7
 * @updated 2013/08/26
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(d){var n=window,E=document,z=void 0,t=["settings"];d.fn.displaytrigger=d.displaytrigger=function(C){function F(e){for(var a=0,c;c=e.context[a];a++)e.id=t.length,e.height=[0,0],t.push(d.extend(!0,{},e)),d(c).unbind(e.nss.displaytrigger).bind(e.nss.displaytrigger,e.id,function(a,b,e){var f=t[a.data],g,c=this,k=arguments.callee;if(f){if(f.delay&&b){for(;g=f.queue.shift();)clearTimeout(g);g=setTimeout(function(){if(f){for(;g=f.queue.shift();)clearTimeout(g);D(a,f,c,b||n)}},f.delay);f.queue.push(g)}else D(a,
f,c,b||n);f.suspend&&!e&&(d(this).unbind(f.nss.displaytrigger),setTimeout(function(){f&&d(c).bind(f.nss.displaytrigger,f.id,k).trigger(f.nss.displaytrigger,[b,!0])},f.suspend))}}),d.data(c,e.nss.data,!0),d(c).unbind(e.nss.scroll).bind(e.nss.scroll,e.id,function(a){(a=t[a.data])&&d(this).trigger(a.nss.displaytrigger,[this])}).unbind(e.nss.resize).bind(e.nss.resize,e.id,function(a){(a=t[a.data])&&d(this).trigger(a.nss.displaytrigger,[this])}),0===a&&d(n).filter(function(){return!e.window&&e.expand}).unbind(e.nss.scroll).bind(e.nss.scroll,
e.id,function(a){(a=t[a.data])&&a.context.trigger(a.nss.displaytrigger,[this])}).unbind(e.nss.resize).bind(e.nss.resize,e.id,function(a){(a=t[a.data])&&a.context.trigger(a.nss.displaytrigger,[this])})}function D(c,a,k,n){var b=a.validate?a.validate.clone({name:"jquery.displaytrigger.js - drive()"}):!1;b&&b.start();b&&(b.scope=function(a){return eval(a)});b&&b.test("++",1,[a,window===n],"drive()");b&&b.test("++",1,0,"initialize");var x=window,f=document,f=a.window?f:k,g=!1,l=d(a.trigger,f),q=l.eq(a.index),
r=d(n).scrollTop(),h=a.height[Number(n===x)],u=r===h?a.direction:r<h?-1:1,h=Math.abs(r-h);b&&b.test("++",1,0,"setting");a.direction!==u&&(a.turn=!0,a.end=!1,a.direction=u,a.index=0>a.index?0:l.length<=a.index?l.length-1:a.index,q=l.eq(a.index));a.distance=0===h?a.distance:h;a.height[Number(n===x)]=r;a.end=q[0]?!1:a.end;-1===a.direction&&a.length<l.length&&(a.turn=!1,a.end=!1);a.length=l.length;b&&b.test("++",1,a,"switch");switch(!0){case !l.length:b&&b.test("*",1,0,"case !targets.length");break;case 0===
a.step&&!q[0]:b&&b.test("*",1,0,"case settings.step === 0 && !target[ 0 ]");a.index+=-1;b&&b.end();return;case 0>a.index:b&&b.test("*",1,0,"case settings.index < 0");a.index=0;a.end=!0;break;case l.length<=a.index:b&&b.test("*",1,0,"case targets.length <= settings.index");a.index=l.length-1;a.end=!0;break;case a.beforehand>a.index&&(a.multi||!a.skip||!d.data(q[0],a.nss.data+"-fired")):b&&b.test("*",1,0,"case settings.beforehand > settings.index &&");a.beforehand===a.index+1&&(a.beforehand=0);g=!0;
break;default:b&&b.test("*",1,0,"default");if(a.end||q.is(":hidden")||!a.multi&&a.skip&&d.data(q[0],a.nss.data+"-fired"))break;b&&b.test("++",1,0,"initialize");var p=d(x),r=p.scrollTop(),u=p.outerHeight(!0),p=d(k),w=a.window?0:p.offset().top,v=p.outerHeight(!0),h=q.offset().top,y=q.outerHeight(!0),p=Math.max(0,a.direction),A=-1<=a.ahead[0]&&1>=a.ahead[0]?parseInt(u*a.ahead[0]):parseInt(a.ahead[0]),B=-1<=a.ahead[1]&&1>=a.ahead[1]?parseInt(u*a.ahead[1]):parseInt(a.ahead[1]),p=p?B:A,m,s;b&&b.test("++",
1,a.mode,"check");switch(a.mode){case "border":g=r+(1===a.direction?-p:u+p);m=g>=h;s=g<=h+y;b&&b.test("++",1,[g,m,s],"border");g=a.turn&&(1===a.direction?g-a.distance>h:g+a.distance<h+y)?!1:a.skip?m&&s:1===a.direction?m:s;break;case "toggle":b&&b.test("++",1,[],"toggle");break;case "hide":b&&b.test("++",1,[],"hide");break;default:m=u+r>=h-B&&(a.window?!0:w+v>=h-B),g=a.window||n!==x?!1:m&&w>h+y+A,s=r<=h+y+A&&(a.window?!0:w<=h+y+A),w=a.window||n!==x?!1:s&&w+v<h-B,b&&b.test("++",1,[m,g,s,w],"show"),
g=a.turn&&a.multi&&(1===a.direction?r-a.distance+u>h-p:r+a.distance<h+y+p)?!1:a.skip?m&&s:1===a.direction?m&&!g:s&&!w&&a.multi}}b&&b.test("/",1,g,"fire");g&&(!a.multi&&++a.count&&a.skip&&d.data(q[0],a.nss.data+"-fired",!0),a.callback.apply(q[0],[c,a.parameter,{index:a.index,length:l.length,direction:a.direction}]));b&&b.test("++",1,0,"terminate");if(!l.length||a.terminate&&!a.multi&&0!==a.step&&a.count>=l.length){m=0;b&&b.test("*",1,0,"unbind node event");d(k).unbind(a.nss.displaytrigger).unbind(a.nss.scroll).unbind(a.nss.resize);
b&&b.test("++",1,0,"remove data");d.removeData(f,a.nss.data);!a.multi&&a.skip&&l.removeData(a.nss.data+"-fired");for(f=0;l=a.context[f];f++)m+=d.data(l,a.nss.data)?1:0;b&&b.test("++",1,0,"unbind root event");!m&&!a.window&&a.expand&&d(x).unbind(a.nss.scroll).unbind(a.nss.resize);b&&b.end();return t[a.id]=z}b&&b.test("++",1,0,"exit");if(!a.end&&!g&&isFinite(p)&&(1===a.direction?!m:!s))return b&&b.end(),a.turn=!1;b&&b.test("++",1,0,"increment");a.index+=0!==a.step||g?0===a.step&&-1===a.direction?a.direction:
a.step*a.direction:a.direction;b&&b.end();a.end||arguments.callee.apply(this,arguments)}if("function"===typeof this)return arguments.callee.apply(d(n),arguments);var k=window.validator instanceof Object?window.validator.clone({name:"jquery.displaytrigger.js",base:!0}):!1;k&&k.start();k&&k.test("++",1,C,"displaytrigger()");k&&k.test("++",1,0,"initialize");var c=d.extend(!0,{},{id:0,gns:"displaytrigger",ns:z,trigger:z,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,expand:!0,
delay:300,suspend:-100,mode:"show",terminate:!0},C),v=[c.gns].concat(c.ns||[]);k&&k.test("++",1,0,"overwrite");d.extend(!0,c,{nss:{displaytrigger:v.join("."),scroll:["scroll"].concat(v.join(":")).join("."),resize:["resize"].concat(v.join(":")).join("."),data:v.join(":"),array:v},window:this[0]===n,context:this,scope:this[0]===n?d(E):d(this),ahead:typeof c.ahead in{string:0,number:0}?[c.ahead,c.ahead]:z,suspend:1<=c.suspend?c.suspend:0<=c.suspend?parseInt(c.delay*c.suspend):Math.max(0,c.delay+c.suspend),
index:0,length:0,count:0,height:{},direction:1,distance:0,turn:!1,end:!1,queue:[],options:C,validate:k});k&&k.test("++",1,0,"register");c.scope.length&&(c.scope.find(c.trigger).length&&arguments.length)&&F(c);k&&k.end();return this}})(jQuery);
