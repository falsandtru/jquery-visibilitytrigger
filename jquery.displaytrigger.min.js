/*
 * 
 * displaytrigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT  http://opensource.org/licenses/mit-license.php  http://sourceforge.jp/projects/opensource/wiki/licenses%2FMIT_license
 * @version 1.1.1
 * @updated 2013/04/12
 * @author falsandtru  http://fat.main.jp/  http://sa-kusaku.sakura.ne.jp/
 * @Compressor YUI Compressor
 */
(function(b){jQuery.fn.displaytrigger=a;jQuery.displaytrigger=a;a=null;var c=["settings"];function a(d){if(typeof this==="function"){return arguments.callee.apply(jQuery(window),arguments)}var j=window,i=document,h={id:0,gns:"displaytrigger",ns:undefined,trigger:undefined,callback:function(){},parameter:[],ahead:0,beforehand:0,index:0,step:1,once:true,skip:false,expand:true,delay:300,terminate:true,reset:true,queue:[]},g=jQuery.extend(true,{},h,d);if(g.reset){jQuery.extend(true,g,{nss:{scroll:["scroll",g.gns+(g.ns?":"+g.ns:"")].join("."),displaytrigger:[g.gns+(g.ns?"."+g.ns:"")].join("."),resize:["resize",g.gns+(g.ns?":"+g.ns:"")].join("."),data:g.gns+(g.ns?":"+g.ns:"")},scope:this.get(0)===j?jQuery(i):jQuery(this),index:0,height:{},direction:"down",distance:0,turn:false,end:false,reset:false})}if(!g.scope.length||!g.scope.find(g.trigger).length||!arguments.length){return this}f(g);function f(m){m.height.window=0;jQuery(j).unbind(m.nss.resize);for(var l=0,k;k=m.scope[l];l++){m.height.element=0;m.id=c.length;c.push(jQuery.extend(true,{},m));jQuery.data(k,m.nss.data,m.id);jQuery(k===i?j:k).unbind(m.nss.scroll).bind(m.nss.scroll,m.id,function(o){var n=c[o.data];jQuery(this).trigger(n.nss.displaytrigger,[this])}).unbind(m.nss.displaytrigger).bind(m.nss.displaytrigger,m.id,function(r,p){var q=c[r.data],s,n,o;n=p;o=this;if(!q.delay){e(r,o,n||j)}else{s=setTimeout(function(){while(s=q.queue.shift()){clearTimeout(s)}c[q.id]=q;e(r,o,n||j)},q.interval);q.queue.push(s);c[q.id]=q}})}jQuery(j).unbind(m.nss.resize).bind(m.nss.resize,m.id,function(o){var n=c[o.data];n.scope.trigger(n.nss.displaytrigger,[this])}).filter(function(){return m.expand&&i!==m.scope.get(0)}).unbind(m.nss.scroll).bind(m.nss.scroll,m.id,function(o){var n=c[o.data];n.scope.trigger(n.nss.displaytrigger,[this])})}function e(y,o,x){var n=window,H=document,B=o===n?H:o,F=false,E,G,C=c[y.data];if(!C){return}E=jQuery(C.trigger,B);G=E.eq(C.index);switch(true){case !E.length:break;case C.index<0:C.index=0;C.end=true;c[C.id]=C;return C.terminate?null:arguments.callee.apply(o,arguments);case C.index>=E.length:C.index=E.length-1;C.end=true;c[C.id]=C;return C.terminate?null:arguments.callee.apply(o,arguments);case C.beforehand>C.index&&!jQuery.data(G.get(0),C.nss.data+"-fired"):F=true;break;case C.once&&jQuery.data(G.get(0),C.nss.data+"-fired"):break;default:var p=jQuery(x).scrollTop(),u=C.height[x===n?"window":"element"],D=p===u?C.direction:p<u?"up":"down",m=D==="up"?u-p:p-u;TURN:{if(C.direction===D){break TURN}C.turn=true;C.end=false;C.direction=D;G=E.eq(C.index)}C.distance=m===0?C.distance:m;C.height[x===n?"window":"element"]=p;if(C.end){break}var w=jQuery(n).scrollTop(),s=G.offset().top,r=jQuery(n).height(),q=G.height(),l=-1<C.ahead&&C.ahead<1?q*C.ahead:C.ahead,t=w>=s-r-l,A=w<=s+q+l;FIRE:{F=C.turn&&!C.once&&(D==="up"?w+C.distance<=s+q+l:w-C.distance>=s-r-l)?false:(C.skip?t&&A:D==="up"?A:t)}END:{if(F||(C.direction==="up"?A:t)){break END}C.turn=false;c[C.id]=C;return}break}if(F){C.once?jQuery.data(G.get(0),C.nss.data+"-fired",true):null;C.callback.apply(G.get(0),[y,C.parameter,C.index,C.direction])}if(C.terminate&&((F&&((C.index===0&&C.step<0)||(C.index===E.length-1&&C.step>0)))||!E.length)){var v=0;x===n?null:jQuery(x).unbind(C.nss.scroll);jQuery(o).unbind(C.nss.displaytrigger).unbind(C.nss.scroll);jQuery.removeData(B,C.nss.data);for(var z=0,k;k=C.scope[z];z++){v+=jQuery.data(k,C.nss.data)?1:0}v?null:jQuery(n).unbind(C.nss.scroll).unbind(C.nss.resize);c[C.id]=undefined;return}C.index+=C.direction==="up"?-C.step:C.step;c[C.id]=C;return C.end?null:arguments.callee.apply(o,arguments)}return this}})(jQuery);
