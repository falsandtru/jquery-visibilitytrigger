/*
 * 
 * visibility trigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.2.5
 * @updated 2014/02/16
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(k,L,M,s){function N(b,g,f,r,e,c){var h=this;switch(!0){case "object"===typeof c&&(b(c,f)[0]||c===g||c===f):return h=h instanceof b?h:b(),e.setProperties.call(h,null,c);case "object"===typeof c:e.setAlias(c.gns);h=h instanceof b?h:b(f);h=e.setProperties.call(h,c.ns||"",null);if(!c.trigger||!c.callback)return h;break;default:return e.setAlias(c),h=h instanceof b?h:b[e.name],e.setProperties.call(h,null,null)}c="object"===typeof c&&b.extend(!0,{gns:e.name,ns:null,context:null,trigger:null,callback:function(){},
parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},c,{id:0,nss:null,root:!h.parent()[0],first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[[],[]],status:{active:!0},timestamp:0,option:c});c.nss={array:[e.name].concat(c.ns&&String(c.ns).split(".")||[])};b.extend(!0,c,{nss:{name:c.ns||"",event:c.nss.array.join("."),alias:e.alias?[e.alias].concat(c.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(c.nss.array.join(":")).join("."),
resize:["resize"].concat(c.nss.array.join(":")).join("."),data:c.nss.array.join("-"),data_fired:c.nss.array.concat("fired").join("-")},ahead:c.ahead instanceof Array?c.ahead.concat(c.ahead).slice(0,2):[c.ahead,c.ahead],beforehand:"boolean"===typeof c.beforehand?-Number(c.beforehand):c.beforehand});e.registrate.call(h,b,g,f,r,e,c);return h}var g;g={name:"visibilitytrigger",alias:"vt",ids:[],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,search:function(b,
n,f){var r,e,c,h,l;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,b,!1,n);case "string":case "":b=b.split(".").sort().join("."),h=RegExp("string"===typeof b?b&&"(?:^|.)"+
b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");case "undefined":case "null":case "0":case "boolean":case "false":var a,d;r=g.settings;for(var K=0;c=this[K];K++){switch(!0){case "object"!==typeof(a=k.data(c,"events")):case !a||"object"!==typeof(a=a[g.name]):continue}for(var t=0;d=a[t];t++)if("number"===typeof d.data||d.type===g.name)switch(c=d.data,b?typeof b:String(b)){case "number":if((e=r[c])&&c===b&&(l=n.call(this,e))!==s)return l;break;case "string":case "":if((e=r[c])&&h.test(d.namespace)&&
(l=n.call(this,e))!==s)return l;break;default:if((e=r[c])&&(l=n.call(this,e))!==s)return l}}if(f&&(l=n.call(this))!==s)return l}return this},redirect:function(b,n,f,r){var e,c,h,l;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":c=g.ids;n=g.settings;for(var a=0;b=c[a];a++)if((e=
n[b])&&(l=f.call(this,e))!==s)return l;if(r&&(l=f.call(this))!==s)return l;break;case "direct:number":case "number":n=g.settings;if((e=n[b])&&(l=f.call(this,e))!==s||r&&(l=f.call(this))!==s)return l;break;case "direct:string":case "direct:":c=g.ids;n=g.settings;b=b.split(".").sort().join(".");h=RegExp("string"===typeof b?b&&"(?:^|.)"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");for(a=0;b=c[a];a++)if((e=n[b])&&h.test(e.nss.name)&&(l=f.call(this,e))!==s)return l;if(r&&(l=f.call(this))!==
s)return l;break;case "string":case "":this.trigger(g.name+(b?"."+b:""),[f,n]);break;case "undefined":case "null":case "0":this.trigger(g.name,[f,n]);break;case "boolean":this.trigger(g.name,[f,!0]);break;case "false":this.trigger(g.name,[f,!1])}return this},setAlias:function(b){g.alias="string"===typeof b?b:g.alias;g.name===g.alias||k[g.alias]||(k[g.name][g.alias]=k.fn[g.name],k.fn[g.alias]=k[g.alias]=k.fn[g.name])},setProperties:function(b,n){var f=this;if(f instanceof k||f===k[g.name])f=f instanceof
k&&n!==s?f.add(n):f,f.vtUID=++g.count,f.vtNamespace="string"===typeof b?b:null,f[g.name]=k[g.name],f.isRegistrate=function(b){return!0===g.search.call(this,b,function(b){return!0})},f.enable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!0}),this},f.disable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!1}),this},f.reset=function(b,e){return g.redirect.call(this,b,e,function(b){this.release(b.id)[g.name](b.option)}),this},f.release=function(b,
e){return g.redirect.call(this,b,e,function(b){g.terminate(b)}),this},f.vtrigger=function(b,e,c){c="string"===typeof b?b.split(/[,\s]\s*/):[b];for(var f=0,n=c.length;f<n;f++)b=c[f],g.redirect.call(this,b,e,function(b,c){k(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[c])});return this};return f},relations:function(b,n,f){var r,e;e=b.split(".");r=k();for(var c=0,h=e.length;c<h;c++)b=e[c],n&&(g.relations[b]=f?(g.relations[b]||k()).not(n):(g.relations[b]||k()).add(n)),r=r.add(g.relations[b]);
return r},registrate:function(b,g,f,r,e,c){var h,l,a;h=this;a=e.ids;l=e.settings;var d,k;d=b(g);k=b(f);k=d.add(k);[].slice.call(arguments);for(var t=0;2>t;t++)h=h[t]===g?h.not(g).add(f):h;for(var t=0,q,p;p=h[t];t++){q=b(p);if(c.terminate&&!q.find(c.trigger)[0])break;if(e.search.call(q[e.name](),c.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return e.redirect.call(this,a.nss.name,!1,function(a){b.extend(!0,a,a.reset)}),
!1;default:return!1}})&&(c=b.extend(!0,{},c),c.id=l.length,c.context=p,a.push(c.id),l[c.id]=c,b.data(p,c.nss.data,c.id),(c.root||c.extend)&&e.relations(c.nss.name,p),!c.multi&&q.find(c.trigger).removeData(c.nss.data_fired),q.bind(c.nss.event,c.id,function(a,c,d){e.countEvent++;var h,k,l,p,q,t,v;h=e.settings[a.data];l=a;q=!0;if(h){switch(c&&typeof c||c){case "function":return v=c,k=d,!k&&l.stopPropagation(),(k||l.target===l.currentTarget)&&v.apply(b(this)[e.name](),[h].concat([].slice.call(arguments,
3)));case "object":k=c,q=!1;default:p=q?0===c?f:l.target:k.target,v=arguments.callee,l.stopPropagation()}b(h.trigger,a.currentTarget).first().is(":hidden")||(t=Number(Boolean(p.parentNode)),function(a,c,d,m){var h=m.queue[t];switch(!0){case !e.settings[m.id]:case !m.status.active:case 3<h.length:break;case m.id!==b.data(a.currentTarget,m.nss.data):b(a.currentTarget)[e.name]().release(m.id);break;default:if(q||!m.delay&&!m.interval){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,r,e,
a,c,d,m)}else{var k,l;for(l=m.interval?(new Date).getTime()-m.timestamp:0;k=h.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,r,e,a,c,d,m)},Math.max(m.delay,m.interval-l,20));h.push(k)}}}(l,k,p,h))}}),q.not(f).bind(c.nss.scroll,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(c.nss.resize,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];
c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}),!(0<t))){var v=0;k.not(p).bind(c.nss.event,c.nss.event,function(a){e.countRedirect++;var c=a.data,d;if(a.target===g)b(f).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===f){var h=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(h);break;case "undefind":d.push(h)}1>v&&(v++,e.relations(c.replace(/^\w+\.?/,"")).filter(h?a.target:"*").not(f).trigger(c,
d),v--)}a.stopPropagation()});c.nss.alias&&k.bind(c.nss.alias,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(c.root||c.extend)&&d.bind(c.nss.scroll,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(c.nss.resize,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}},drive:function(b,g,f,k,e,c,h,
l,a,d){e.countDrive++;var s,t,q,p,v,m,x,w,z,y,u;d=d||{};s=d.context=d.update?d.context:b(c.currentTarget);t=d.eventcontext=d.update?d.eventcontext:b(l);d.root=d.update?d.root:!s.parent()[0];q=d.layer=d.update?d.layer:Number(Boolean(t.parent()[0]));m=v=p=!1;x=d.targets=d.update&&a.step?d.targets:s.find(a.trigger);x=d.targets=0<=a.index||x.length>a.index?d.targets:s.find(a.trigger);z=d.evtScroll=d.update?d.evtScroll:t.scrollTop();t=w=d.evtHeight=d.update?d.evtHeight:a.height[q];y=d.direction=d.update?
d.direction:z===w?a.direction:z<w?-1:1;u=d.distance=d.update?d.distance:Math.abs(z-w);w=x.eq(a.index);a.direction!==y&&(a.turn=!0,a.end=!1,a.direction=y,a.index=0>a.index?0:x.length<=a.index?x.length-1:a.index,w=x.eq(a.index));a.distance=0===u?a.distance:u;a.height[q]=z;switch(!0){case 0>a.index||x.length<=a.index:break;case !x.length||!w[0]:break;default:var A,B,D,E,F;m=d.$win=d.update?d.$win:b(g);v=d.winTop=d.update?d.winTop:m.scrollTop();m=d.winHeight=d.update?d.winHeight:m.height();z=v+m;var C,
I,G,H;u=a.ahead[0];y=d.aheadTop=d.update?d.aheadTop:"number"===typeof u?parseInt(u,10):parseInt(eval(m+u),10);u=a.ahead[1];C=d.aheadBottom=d.update?d.aheadBottom:"number"===typeof u?parseInt(u,10):parseInt(eval(m+u),10);I=d.beforehand=d.beforehand?d.beforehand:0>a.beforehand?x.length+a.beforehand+1:a.beforehand;A=s;a.root?(u=d.frameTop=d.update?d.frameTop:v,m=d.frameHeight=d.update?d.frameHeight:m):(u=d.frameTop=d.update?d.frameTop:parseInt(A.offset().top,10),m=d.frameHeight=d.update?d.frameHeight:
A.outerHeight());A=u+m;E=d.visibleTop=d.update?d.visibleTop:Math.max(u,v);F=d.visibleBottom=d.update?d.visibleBottom:Math.min(A,z);B=parseInt(w.offset().top,10);m=w.outerHeight();D=B+m;G=F>=B-C;H=E<=D+y;m=1===a.direction?G:H;switch(!0){case a.first&&I>a.index&&(a.multi||!b.data(w[0],a.nss.data_fired)):I>a.index&&(p=m=!0);break;case q?!1:E>A+C||F<u-y:m=1===a.direction?E>A&&A>B-C:F<u&&u<D+y;break;case !a.skip&&!a.multi:p=1===a.direction?G:H;break;case a.skip&&!a.multi:p=G&&H;break;case !a.skip&&a.multi:p=
1===a.direction?G:H;a.first||h&&"resize"===h.type||(p=1===a.direction?(q?F>B+a.distance-y:z>B+a.distance-y)?!1:p:(q?E<D-a.distance+C:v<D-a.distance+C)?!1:p);break;case a.skip&&a.multi:p=G&&H,a.first||h&&"resize"===h.type||(p=1===a.direction?(q?F>B+a.distance-y:z>B+a.distance-y)?!1:p:(q?E<D-a.distance+C:v<D-a.distance+C)?!1:p)}v=a.step?a.step*a.direction:p?-1===a.direction&&-1||0:a.direction;p&&!a.multi&&(p=w[0]&&b.data(w[0],a.nss.data_fired)?!1:p,p=a.turn&&!d.recursion?!1:p)}if(p){if(a.interval){var J=
(new Date).getTime();if(a.interval<=J-a.timestamp)a.timestamp=J;else return function(a,c,d){var e=setTimeout(function(){b(a.currentTarget).trigger(d.nss.event,[c])},Math.max(d.interval-J+d.timestamp,20));d.queue[q].push(e)}(c,h,a),a.height[q]=t,!0}e.countCallback++;++a.count&&b.data(w[0],a.nss.data_fired,a.id);!1===a.callback.apply(w[0],[c,h,{container:s[0],activator:l,selector:a.trigger,index:a.index,direction:a.direction,distance:a.distance,relations:a.root||a.extend?e.relations(a.nss.name):null,
parameter:a.parameter}])&&a.count--&&b.removeData(w[0],a.nss.data_fired)}if(a.terminate&&(!x.length||!a.multi&&a.step&&a.count>=x.length))return s[e.name]().release(a.id),!0;a.index+=m?v:0;d.update=d.update||a.cache;d.recursion?m&&arguments.callee.apply(this,arguments):(d.recursion=!0,m&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));a.first=!1;a.turn=!1;d.recursion=!1;return!0},terminate:function(b){var n,f;f=b.context;n=k(f);k.removeData(f,b.nss.data);!b.multi&&n.find(b.trigger).removeData(b.nss.data_fired);
n.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);if(b.root||b.extend)g.relations(b.nss.name,n,!0)[0]||k(L).unbind(b.nss.scroll).unbind(b.nss.resize).add(M).unbind(b.nss.event).unbind(b.nss.alias);n=g.ids;for(var r=n.length;f=n[--r];)if(f===b.id){n.splice(r,1);g.settings[f]=s;break}}};(function(b,g,f,k,e){b.fn[e.name]=b[e.name]=function(){return N.apply(this,[b,g,f,k,e].concat([].slice.call(arguments)))};e.setProperties.call(b[e.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,
window,document,void 0);
