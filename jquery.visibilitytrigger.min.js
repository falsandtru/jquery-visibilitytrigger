/*
 * 
 * visibility trigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.0.1
 * @updated 2013/11/29
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(s,D,K,m){function N(b,r,h,g,f,c){var l=c&&c.validator?c.validator.clone({name:"jquery.visibilitytrigger.js",base:!0}):!1;l&&l.start();l&&l.test("++",1,[c],"visibilitytrigger()");l&&l.test("++",1,0,"initialize");var k=this instanceof b?this.add():this;switch(!0){case "object"===typeof c:k=k instanceof b?k:b(h);f.setAlias(c.gns);f.setProperties.call(k,c.ns||"",f);if(!c.trigger||!c.callback)return k;break;default:return f.setAlias(c),f.setProperties.call(k,null,f),k}l&&l.test("++",1,0,"set variable");
c="object"===typeof c&&b.extend(!0,{gns:f.name,ns:null,context:null,trigger:null,callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},c,{id:0,nss:null,root:!k.parent()[0],first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[],status:{active:!0},timestamp:0,option:c});c.nss={array:[f.name].concat(c.ns&&String(c.ns).split(".")||[])};b.extend(!0,c,{nss:{name:c.ns||"",event:c.nss.array.join("."),
alias:f.alias?[f.alias].concat(c.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(c.nss.array.join(":")).join("."),resize:["resize"].concat(c.nss.array.join(":")).join("."),data:c.nss.array.join("-"),data_fired:c.nss.array.concat("fired").join("-")},ahead:typeof c.ahead in{string:0,number:0}?[c.ahead,c.ahead]:g});l&&l.test("++",1,0,"registrate");f.registrate.call(k,b,r,h,g,f,c);l&&l.end();return k}function L(b){var r=[].slice.call(arguments,1);return function(){b.apply(this,r.concat([].slice.call(arguments)))}}
var v=D.validator?D.validator.clone({name:"jquery.visibilitytrigger.js",base:!0}):!1;v&&v.start();v&&v.test("++",1,0,"initialize");var g;v&&v.test("++",1,[g],"set plugin");g={name:"visibilitytrigger",alias:"vt",ids:[0],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,search:function(b,r,h){var u,f,c,l,k;!b&&""!==b&&this.vtUID&&this instanceof s&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof s?b?typeof b:String(b):
"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,b,!1,r);case "string":case "":l=RegExp(b?"^"+b+"(?:$|.)":"^$");case "undefined":case "null":case "0":case "boolean":case "false":var a,d;u=g.settings;for(var e=0;c=this[e];e++){switch(!0){case "object"!==typeof(a=s.data(c,"events")):case !a||"object"!==typeof(a=a[g.name]):continue}for(var M=
0;d=a[M];M++)if("number"===typeof d.data||d.type===g.name)switch(c=d.data,b?typeof b:String(b)){case "number":if((f=u[c])&&c===b&&(k=r.call(this,f))!==m)return k;break;case "string":case "":if((f=u[c])&&l.test(d.namespace)&&(k=r.call(this,f))!==m)return k;break;default:if((f=u[c])&&(k=r.call(this,f))!==m)return k}}if(h&&(k=r.call(this))!==m)return k}return this},redirect:function(b,r,h,u){var f,c,l,k;!b&&""!==b&&this.vtUID&&this instanceof s&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);
switch(this instanceof s?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":c=g.ids;r=g.settings;for(var a=1;b=c[a];a++)if((f=r[b])&&(k=h.call(this,f))!==m)return k;if(u&&(k=h.call(this))!==m)return k;break;case "direct:number":case "number":r=g.settings;if((f=r[b])&&(k=h.call(this,f))!==m||u&&(k=h.call(this))!==m)return k;break;case "direct:string":case "direct:":c=g.ids;r=g.settings;l=RegExp(b?
"^"+b+"(?:$|.)":"^$");for(a=1;b=c[a];a++)if((f=r[b])&&l.test(f.nss.name)&&(k=h.call(this,f))!==m)return k;if(u&&(k=h.call(this))!==m)return k;break;case "string":case "":this.trigger(g.name+(b?"."+b:""),[h,r]);break;case "undefined":case "null":case "0":case "boolean":case "false":this.trigger(g.name,[h,r])}return this},setAlias:function(b){(b=(b=b||g.alias)?String(b):"")&&g.name!==b&&!s[b]&&(g.alias=b,s.fn[g.alias]=s[g.alias]=s.fn[g.name])},setProperties:function(b){this.vtUID=++g.count;this.vtNamespace=
"string"===typeof b?b:null;this.isRegistrate=function(b){var h=RegExp(b?"^"+b+"$":""===b?"^$":"");return!0===g.search.call(this,b,function(b){if(h.test(b.nss.name))return!0})};this.enable=function(b,h){return g.redirect.call(this,b,h,function(b){b.status.active=!0}),this};this.disable=function(b,h){return g.redirect.call(this,b,h,function(b){b.status.active=!1}),this};this.reset=function(b,h){var u=RegExp(b?"^"+b+"$":""===b?"^$":"");return g.redirect.call(this,b,h,function(b){if(u.test(b.nss.name))this.release(b.id)[g.name](b.option)}),
this};this.release=function(b,h){return g.redirect.call(this,b,h,function(b){g.terminate(b)}),this};this.vtrigger=function(b,h,u){u="string"===typeof b?b.split(/,\s*/):[b];for(var f=0,c=u.length;f<c;f++)b=u[f],g.redirect.call(this,b,h,function(b,c){s(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[c])});return this}},registrate:function(b,g,h,u,f,c){var l,k,a,d;l=this;d=f.ids;k=f.settings;var e,s;e=b(g);a=b(h);s=e.add(a);[].slice.call(arguments);for(var n=0;2>n;n++)l=l[n]===g?l.not(g).add(h):
l;for(var n=0,q,p;p=l[n];n++){q=b(p)[f.name]();if(c.terminate&&!q.find(c.trigger)[0])break;if(f.search.call(q,c.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return f.redirect.call(q,a.nss.name,!1,function(a){b.extend(!0,a,a.reset)}),!1;default:return!1}})){c=b.extend(!0,{},c);c.id=k.length;c.context=p;d.push(c.id);k[c.id]=c;b.data(p,c.nss.data,c.id);if(c.root||c.extend)a=f.relations[c.nss.name],f.relations[c.nss.name]=
a?a=a.add(q):a=q;!c.multi&&q.find(c.trigger).removeData(c.nss.data_fired);q.bind(c.nss.event,c.id,function(a,c,d){f.countEvent++;var e,k,l,p,n,q,s;e=f.settings[a.data];l=a;n=!0;if(e){switch(c&&typeof c||c){case "function":return s=c,!d&&l.stopPropagation(),s.apply(b(this)[f.name](),[e].concat([].slice.call(arguments,3)));case "object":k=c,n=!1;default:p=n?0===c?h:l.target:k.target,s=arguments.callee,l.stopPropagation()}q=new L(function(a,c,d,e){switch(!0){case !f.settings[e.id]:case !e.status.active:break;
case e.id!==b.data(a.currentTarget,e.nss.data):b(a.currentTarget)[f.name]().release(e.id);break;default:f.drive(b,g,h,u,f,a,c,d,e)}},l,k,p);if(n||!e.delay)q=q(e);else{for(var m;m=e.queue.shift();)clearTimeout(m);m=setTimeout(function(){if(e){for(;m=e.queue.shift();)clearTimeout(m);f.countTask++;q=e&&q(e)}},e.delay);e.queue.push(m)}}});q.not(h).bind(c.nss.scroll,c.id,function(a){f.countRedirect++;var c=f.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(c.nss.resize,
c.id,function(a){f.countRedirect++;var c=f.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()});if(!(0<n)){var m=0;s.not(p).bind(c.nss.event,c.nss.event,function(a){f.countRedirect++;var c=a.data,d;if(a.target===g)b(h).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===h){var e=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(e);break;case "undefind":d.push(e)}!m++&&b(f.relations[c.replace(/^\w+\.?/,
"")||""]).filter(e?a.target:"*").not(h).trigger(c,d);m--}a.stopPropagation()});c.nss.alias&&s.bind(c.nss.alias,c.nss.event,function(a){f.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(c.root||c.extend)&&e.bind(c.nss.scroll,c.nss.event,function(a){f.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(c.nss.resize,c.nss.event,function(a){f.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}}},
drive:function(b,g,h,s,f,c,l,k,a,d){var e=a.validate?a.validate.clone({name:"jquery.visibilitytrigger.js - drive()"}):!1;e&&e.start();e&&(e.scope=function(a){return eval(a)});e&&e.test("++",1,[a],"drive()");e&&e.test("++",1,0,"initialize");f.countDrive++;var m,n,q,p,A,t,w,y,E,F;e&&e.test("++",1,0,"setting");d=d||{};m=d.context=d.update?d.context:b(c.currentTarget);n=d.eventcontext=d.update?d.eventcontext:b(k);root=d.root=d.update?d.root:!m.parent()[0];q=d.layer=d.update?d.layer:Number(Boolean(n.parent()[0]));
t=A=p=!1;w=d.targets=d.update&&a.step?d.targets:m.find(a.trigger);w=d.targets=0<=a.index||w.length>a.index?d.targets:m.find(a.trigger);y=d.evtScroll=d.update?d.evtScroll:n.scrollTop();n=d.evtHeight=d.update?d.evtHeight:a.height[q];E=d.direction=d.update?d.direction:y===n?a.direction:y<n?-1:1;F=d.distance=d.update?d.distance:Math.abs(y-n);n=w.eq(a.index);a.direction!==E&&(a.turn=!0,a.end=!1,a.direction=E,a.index=0>a.index?0:w.length<=a.index?w.length-1:a.index,n=w.eq(a.index));a.distance=0===F?a.distance:
F;a.height[q]=y;e&&e.test("++",1,a,"switch");switch(!0){case !w.length||!n[0]:e&&e.test("*",1,0,"case !targets.length || !target[0]");break;case 0>a.index||w.length<=a.index:e&&e.test("*",1,0,"case setting.index < 0 || targets.length <= setting.index");break;default:e&&e.test("*",1,0,"default");e&&e.test("++",1,0,"initialize");var B,z,C,G,v,J;t=d.$win=d.update?d.$win:b(g);A=d.winTop=d.update?d.winTop:t.scrollTop();t=d.winHeight=d.update?d.winHeight:t.height();y=A+t;var x,H,I;z=Math.max(0,a.direction);
E=d.aheadTop=d.update?d.aheadTop:-1<=a.ahead[0]&&1>=a.ahead[0]?parseInt(t*a.ahead[0],10):parseInt(a.ahead[0],10);F=d.aheadBottom=d.update?d.aheadBottom:-1<=a.ahead[1]&&1>=a.ahead[1]?parseInt(t*a.ahead[1],10):parseInt(a.ahead[1],10);x=z?F:E;B=m;a.root?(z=d.frameTop=d.update?d.frameTop:A,t=d.frameHeight=d.update?d.frameHeight:t):(z=d.frameTop=d.update?d.frameTop:parseInt(B.offset().top,10),t=d.frameHeight=d.update?d.frameHeight:B.outerHeight());B=z+t;v=d.visibleTop=d.update?d.visibleTop:Math.max(z,
A);J=d.visibleBottom=d.update?d.visibleBottom:Math.min(B,y);C=parseInt(n.offset().top,10);t=n.outerHeight();G=C+t;e&&e.test("++",1,a.mode,"check");H=J>=C-F;I=v<=G+E;e&&e.test("++",1,[H,I],"show");t=1===a.direction?H:I;switch(!0){case q?!1:v>B+x||J<z-x:t=1===a.direction?v>B&&B>=C-F:J<z&&z<=G+E;break;case a.first&&a.beforehand>a.index&&(a.multi||!b.data(n[0],a.nss.data_fired)):a.beforehand>a.index?p=t=!0:a.beforehand=0;break;case !a.skip&&!a.multi:p=1===a.direction?H:I;break;case a.skip&&!a.multi:p=
H&&I;break;case !a.skip&&a.multi:p=1===a.direction?H:I;a.first||l&&"resize"===l.type||(p=1===a.direction?(q?J>C+a.distance-x:y>C+a.distance-x)?!1:p:(q?v<G-a.distance+x:A<G-a.distance+x)?!1:p);break;case a.skip&&a.multi:p=H&&I,a.first||l&&"resize"===l.type||(p=1===a.direction?(q?J>C+a.distance-x:y>C+a.distance-x)?!1:p:(q?v<G-a.distance+x:A<G-a.distance+x)?!1:p)}A=a.step?a.step*a.direction:p?0:a.direction;p&&!a.multi&&(p=n[0]&&b.data(n[0],a.nss.data_fired)?!1:p,p=a.turn&&!d.recursion?!1:p)}e&&e.test("/",
1,p,"fire");if(p){e&&e.test("*",1,a.interval,"interval");if(a.interval)if(q=(new Date).getTime(),a.interval<=q-a.timestamp)e&&e.test("++",1,0,"pass"),a.timestamp=q;else{e&&e.test("++",1,0,"cancel");var D=new L(function(a,c,d){b(a.currentTarget).trigger(d.nss.event,[c])},c,l);id=setTimeout(function(){D=a&&D(a)},Math.max(a.interval-q+a.timestamp,50));a.queue.push(id);e&&e.end();return!0}f.countCallback++;!a.multi&&++a.count&&b.data(n[0],a.nss.data_fired,a.id);!1===a.callback.apply(n[0],[c,l,{contaner:m[0],
activator:k,selector:a.trigger,index:a.index,direction:a.direction,distance:a.distance,relations:a.root||a.extend?f.relations[a.nss.name]:null,parameter:a.parameter}])&&!a.multi&&a.count--&&b.removeData(n[0],a.nss.data_fired)&&(p=!1)}e&&e.test("/",1,0,"terminate");if(a.terminate&&(!w.length||a.step&&a.count>=w.length))return m[f.name]().release(a.id),e&&e.end(),!0;e&&e.test("++",1,0,"increment");a.index+=t?A:0;e&&e.test("++",1,0,"recursion");d.update=d.update||a.cache;d.recursion?t&&arguments.callee.apply(this,
arguments):(d.recursion=!0,t&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));a.first=!1;a.turn=!1;d.recursion=!1;e&&e.end();return!0},terminate:function(b){var r,h;h=b.context;r=s(h);s.removeData(h,b.nss.data);!b.multi&&r.find(b.trigger).removeData(b.nss.data_fired);r.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);if(b.root||b.extend)h=g.relations[b.nss.name],g.relations[b.nss.name]=h=h.not(r),h[0]||s(D).unbind(b.nss.scroll).unbind(b.nss.resize).add(K).unbind(b.nss.event).unbind(b.nss.alias);
ids=g.ids;for(r=ids.length;id=ids[--r];)if(id===b.id){ids.splice(r,1);g.settings[id]=m;break}}};(function(b,g,h,m,f){b.fn[f.name]=b[f.name]=function(){return N.apply(this,[b,g,h,m,f].concat([].slice.call(arguments)))};f.setProperties.call(b[f.name])})(s,D,K,m,g)})(jQuery,window,document,void 0);
