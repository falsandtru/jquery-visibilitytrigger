/*
 * 
 * visibility trigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.2.6
 * @updated 2014/02/19
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(l,J,K,r){function L(b,g,f,q,e,c){var h=this;switch(!0){case "object"===typeof c&&(b(c,f)[0]||c===g||c===f):return h=h instanceof b?h:b(),e.setProperties.call(h,null,c);case "object"===typeof c:e.setAlias(c.gns);h=h instanceof b?h:b(f);h=e.setProperties.call(h,c.ns||"",null);if(!c.trigger||!c.callback)return h;break;default:return e.setAlias(c),h=h instanceof b?h:b[e.name],e.setProperties.call(h,null,null)}c="object"===typeof c&&b.extend(!0,{gns:e.name,ns:null,trigger:null,callback:function(){},
parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},c,{id:0,nss:null,context:null,root:!h.parent()[0],first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[[],[]],status:{active:!0},timestamp:0,option:c});c.nss={array:[e.name].concat(c.ns&&String(c.ns).split(".")||[])};b.extend(!0,c,{nss:{name:c.ns||"",event:c.nss.array.join("."),alias:e.alias?[e.alias].concat(c.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(c.nss.array.join(":")).join("."),
resize:["resize"].concat(c.nss.array.join(":")).join("."),data:c.nss.array.join("-"),data_fired:c.nss.array.concat("fired").join("-")},ahead:c.ahead instanceof Array?c.ahead.concat(c.ahead).slice(0,2):[c.ahead,c.ahead],beforehand:"boolean"===typeof c.beforehand?-Number(c.beforehand):c.beforehand});e.registrate.call(h,b,g,f,q,e,c);return h}var g;g={name:"visibilitytrigger",alias:"vt",ids:[],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,search:function(b,
n,f){var q,e,c,h,p;!b&&""!==b&&this.vtUID&&this instanceof l&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof l?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,b,!1,n);case "string":case "":b=b.split(".").sort().join("."),h=RegExp("string"===typeof b?b&&"(?:^|.)"+
b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");case "undefined":case "null":case "0":case "boolean":case "false":var a,d;q=g.settings;for(var I=0;c=this[I];I++){switch(!0){case "object"!==typeof(a=l.data(c,"events")):case !a||"object"!==typeof(a=a[g.name]):continue}for(var t=0;d=a[t];t++)if("number"===typeof d.data||d.type===g.name)switch(c=d.data,b?typeof b:String(b)){case "number":if((e=q[c])&&c===b&&(p=n.call(this,e))!==r)return p;break;case "string":case "":if((e=q[c])&&h.test(d.namespace)&&
(p=n.call(this,e))!==r)return p;break;default:if((e=q[c])&&(p=n.call(this,e))!==r)return p}}if(f&&(p=n.call(this))!==r)return p}return this},redirect:function(b,n,f,q){var e,c,h,p;!b&&""!==b&&this.vtUID&&this instanceof l&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof l?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":c=g.ids;n=g.settings;for(var a=0;b=c[a];a++)if((e=
n[b])&&(p=f.call(this,e))!==r)return p;if(q&&(p=f.call(this))!==r)return p;break;case "direct:number":case "number":n=g.settings;if((e=n[b])&&(p=f.call(this,e))!==r||q&&(p=f.call(this))!==r)return p;break;case "direct:string":case "direct:":c=g.ids;n=g.settings;b=b.split(".").sort().join(".");h=RegExp("string"===typeof b?b&&"(?:^|.)"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");for(a=0;b=c[a];a++)if((e=n[b])&&h.test(e.nss.name)&&(p=f.call(this,e))!==r)return p;if(q&&(p=f.call(this))!==
r)return p;break;case "string":case "":this.trigger(g.name+(b?"."+b:""),[f,n]);break;case "undefined":case "null":case "0":this.trigger(g.name,[f,n]);break;case "boolean":this.trigger(g.name,[f,!0]);break;case "false":this.trigger(g.name,[f,!1])}return this},setAlias:function(b){g.alias="string"===typeof b?b:g.alias;g.name===g.alias||l[g.alias]||(l[g.name][g.alias]=l.fn[g.name],l.fn[g.alias]=l[g.alias]=l.fn[g.name])},setProperties:function(b,n){var f=this;if(f instanceof l||f===l[g.name])f=f instanceof
l&&n!==r?f.add(n):f,f.vtUID=++g.count,f.vtNamespace="string"===typeof b?b:null,f[g.name]=l[g.name],f.isRegistrate=function(b){return!0===g.search.call(this,b,function(b){return!0})},f.enable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!0}),this},f.disable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!1}),this},f.reset=function(b,e){return g.redirect.call(this,b,e,function(b){this.release(b.id)[g.name](b.option)}),this},f.release=function(b,
e){return g.redirect.call(this,b,e,function(b){g.terminate(b)}),this},f.vtrigger=function(b,e,c){c="string"===typeof b?b.split(/[,\s]\s*/):[b];for(var f=0,n=c.length;f<n;f++)b=c[f],g.redirect.call(this,b,e,function(b,c){l(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[c])});return this};return f},relations:function(b,n,f){var q,e;e=b.split(".");q=l();for(var c=0,h=e.length;c<h;c++)b=e[c],n&&(g.relations[b]=f?(g.relations[b]||l()).not(n):(g.relations[b]||l()).add(n)),q=q.add(g.relations[b]);
return q},registrate:function(b,g,f,q,e,c){var h,p,a;h=this;a=e.ids;p=e.settings;var d,l;d=b(g);l=b(f);l=d.add(l);[].slice.call(arguments);for(var t=0;2>t;t++)h=h[t]===g?h.not(g).add(f):h;for(var t=0,s,k;k=h[t];t++){s=b(k);if(c.terminate&&!s.find(c.trigger)[0])break;if(e.search.call(s[e.name](),c.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return e.redirect.call(this,a.nss.name,!1,function(a){b.extend(!0,a,a.reset)}),
!1;default:return!1}})&&(c=b.extend(!0,{},c),c.id=p.length,c.context=k,a.push(c.id),p[c.id]=c,b.data(k,c.nss.data,c.id),(c.root||c.extend)&&e.relations(c.nss.name,k),!c.multi&&s.find(c.trigger).removeData(c.nss.data_fired),s.bind(c.nss.event,c.id,function(a,c,d){e.countEvent++;var h,l,k,p,u,t,s;h=e.settings[a.data];k=a;u=!0;if(h){switch(c&&typeof c||c){case "function":return s=c,l=d,!l&&k.stopPropagation(),(l||k.target===k.currentTarget)&&s.apply(b(this)[e.name](),[h].concat([].slice.call(arguments,
3)));case "object":l=c,u=!1;default:p=u?0===c?f:k.target:l.target,s=arguments.callee,k.stopPropagation()}b(h.trigger,a.currentTarget).first().is(":hidden")||(t=Number(Boolean(p.parentNode)),function(a,c,d,m){var h=m.queue[t];switch(!0){case !e.settings[m.id]:case !m.status.active:case 3<h.length:break;case m.id!==b.data(a.currentTarget,m.nss.data):b(a.currentTarget)[e.name]().release(m.id);break;default:if(u||!m.delay&&!m.interval){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,q,e,
a,c,d,m)}else{var k,l;for(l=m.interval?(new Date).getTime()-m.timestamp:0;k=h.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,q,e,a,c,d,m)},Math.max(m.delay,m.interval-l,20));h.push(k)}}}(k,l,p,h))}}),s.not(f).bind(c.nss.scroll,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(c.nss.resize,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];
c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}),!(0<t))){var w=0;l.not(k).bind(c.nss.event,c.nss.event,function(a){e.countRedirect++;var c=a.data,d;if(a.target===g)b(f).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===f){var h=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(h);break;case "undefind":d.push(h)}1>w&&(w++,e.relations(c.replace(/^\w+\.?/,"")).filter(h?a.target:"*").not(f).trigger(c,
d),w--)}a.stopPropagation()});c.nss.alias&&l.bind(c.nss.alias,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(c.root||c.extend)&&d.bind(c.nss.scroll,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(c.nss.resize,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}},drive:function(b,g,f,l,e,c,h,
p,a,d){e.countDrive++;var r,t,s,k,w,m,x,v,y,A,B;d=d||{};r=d.context=d.update?d.context:b(c.currentTarget);t=d.eventcontext=d.update?d.eventcontext:b(p);d.root=d.update?d.root:!r.parent()[0];s=d.layer=d.update?d.layer:Number(Boolean(t.parent()[0]));m=w=k=!1;x=d.targets=d.update&&a.step?d.targets:r.find(a.trigger);x=d.targets=0<=a.index||x.length>a.index?d.targets:r.find(a.trigger);y=d.evtScroll=d.update?d.evtScroll:t.scrollTop();t=v=d.evtHeight=d.update?d.evtHeight:a.height[s];A=d.direction=d.update?
d.direction:y===v?a.direction:y<v?-1:1;B=d.distance=d.update?d.distance:Math.abs(y-v);v=x.eq(a.index);a.direction!==A&&(a.turn=!0,a.end=!1,a.direction=A,a.index=0>a.index?0:x.length<=a.index?x.length-1:a.index,v=x.eq(a.index));a.distance=0===B?a.distance:B;a.height[s]=y;switch(!0){case 0>a.index||x.length<=a.index:break;case !x.length||!v[0]:break;default:var z,u,C,F;y=d.$win=d.update?d.$win:b(g);w=d.winTop=d.update?d.winTop:y.scrollTop();z=d.winHeight=d.update?d.winHeight:y.height();y=w+z;var G,
D,E;m=a.ahead[0];A=d.aheadTop=d.update?d.aheadTop:"number"===typeof m?parseInt(m,10):parseInt(eval(z+m),10);m=a.ahead[1];B=d.aheadBottom=d.update?d.aheadBottom:"number"===typeof m?parseInt(m,10):parseInt(eval(z+m),10);G=d.beforehand=d.beforehand?d.beforehand:0>a.beforehand?x.length+a.beforehand+1:a.beforehand;u=r;a.root?(m=d.frameTop=d.update?d.frameTop:w,z=d.frameHeight=d.update?d.frameHeight:z):(m=d.frameTop=d.update?d.frameTop:parseInt(u.offset().top,10),z=d.frameHeight=d.update?d.frameHeight:
u.outerHeight());u=m+z;z=d.visibleTop=d.update?d.visibleTop:Math.max(m,w);F=d.visibleBottom=d.update?d.visibleBottom:Math.min(u,y);u=parseInt(v.offset().top,10);m=v.outerHeight();C=u+m;D=F>=u-B;E=z<=C+A;m=1===a.direction?D:E;switch(!0){case a.first&&G>a.index&&(a.multi||!b.data(v[0],a.nss.data_fired)):G>a.index&&(k=m=!0);break;case !a.skip&&!a.multi:k=1===a.direction?D:E;break;case a.skip&&!a.multi:k=D&&E;break;case !a.skip&&a.multi:k=1===a.direction?D:E;!k||a.first||h&&"resize"===h.type||(k=1===
a.direction?(s?F>=u+a.distance-B:y>=u+a.distance-B)?!1:k:(s?z<=C-a.distance+A:w<=C-a.distance+A)?!1:k);break;case a.skip&&a.multi:k=D&&E,!k||a.first||h&&"resize"===h.type||(k=1===a.direction?(s?F>=u+a.distance-B:y>=u+a.distance-B)?!1:k:(s?z<=C-a.distance+A:w<=C-a.distance+A)?!1:k)}w=a.step?a.step*a.direction:k?-1===a.direction&&-1||0:a.direction;k&&!a.multi&&(k=v[0]&&b.data(v[0],a.nss.data_fired)?!1:k,k=a.turn&&!d.recursion?!1:k)}if(k){if(a.interval){var H=(new Date).getTime();if(a.interval<=H-a.timestamp)a.timestamp=
H;else return function(a,c,d){var e=setTimeout(function(){b(a.currentTarget).trigger(d.nss.event,[c])},Math.max(d.interval-H+d.timestamp,20));d.queue[s].push(e)}(c,h,a),a.height[s]=t,!0}e.countCallback++;++a.count&&b.data(v[0],a.nss.data_fired,a.id);!1===a.callback.apply(v[0],[c,h,{container:r[0],activator:p,selector:a.trigger,index:a.index,direction:a.direction,distance:a.distance,relations:a.root||a.extend?e.relations(a.nss.name):null,parameter:a.parameter}])&&a.count--&&b.removeData(v[0],a.nss.data_fired)}if(a.terminate&&
(!x.length||!a.multi&&a.step&&a.count>=x.length))return r[e.name]().release(a.id),!0;a.index+=m?w:0;d.update=d.update||a.cache;d.recursion?m&&arguments.callee.apply(this,arguments):(d.recursion=!0,m&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));a.first=!1;a.turn=!1;d.recursion=!1;return!0},terminate:function(b){var n,f;f=b.context;n=l(f);l.removeData(f,b.nss.data);!b.multi&&n.find(b.trigger).removeData(b.nss.data_fired);n.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);
if(b.root||b.extend)g.relations(b.nss.name,n,!0)[0]||l(J).unbind(b.nss.scroll).unbind(b.nss.resize).add(K).unbind(b.nss.event).unbind(b.nss.alias);n=g.ids;for(var q=n.length;f=n[--q];)if(f===b.id){n.splice(q,1);g.settings[f]=r;break}}};(function(b,g,f,l,e){b.fn[e.name]=b[e.name]=function(){return L.apply(this,[b,g,f,l,e].concat([].slice.call(arguments)))};e.setProperties.call(b[e.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,window,document,void 0);
