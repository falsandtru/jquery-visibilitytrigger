/*
 * 
 * visibility trigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.2.2
 * @updated 2014/01/17
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(k,K,L,s){function M(b,g,f,r,e,c){var h=this;switch(!0){case "object"===typeof c&&(b(c,f)[0]||c===g||c===f):return h=h instanceof b?h:b(),e.setProperties.call(h,null,c);case "object"===typeof c:e.setAlias(c.gns);h=h instanceof b?h:b(f);h=e.setProperties.call(h,c.ns||"",null);if(!c.trigger||!c.callback)return h;break;default:return e.setAlias(c),h=h instanceof b?h:b[e.name],e.setProperties.call(h,null,null)}c="object"===typeof c&&b.extend(!0,{gns:e.name,ns:null,context:null,trigger:null,callback:function(){},
parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},c,{id:0,nss:null,root:!h.parent()[0],first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[[],[]],status:{active:!0},timestamp:0,option:c});c.nss={array:[e.name].concat(c.ns&&String(c.ns).split(".")||[])};b.extend(!0,c,{nss:{name:c.ns||"",event:c.nss.array.join("."),alias:e.alias?[e.alias].concat(c.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(c.nss.array.join(":")).join("."),
resize:["resize"].concat(c.nss.array.join(":")).join("."),data:c.nss.array.join("-"),data_fired:c.nss.array.concat("fired").join("-")},ahead:c.ahead instanceof Array?c.ahead.concat(c.ahead).slice(0,2):[c.ahead,c.ahead],beforehand:"boolean"===typeof c.beforehand?-Number(c.beforehand):c.beforehand});e.registrate.call(h,b,g,f,r,e,c);return h}var g;g={name:"visibilitytrigger",alias:"vt",ids:[],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,search:function(b,
n,f){var r,e,c,h,p;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,b,!1,n);case "string":case "":b=b.split(".").sort().join("."),h=RegExp("string"===typeof b?b&&"(?:^|.)"+
b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");case "undefined":case "null":case "0":case "boolean":case "false":var a,d;r=g.settings;for(var J=0;c=this[J];J++){switch(!0){case "object"!==typeof(a=k.data(c,"events")):case !a||"object"!==typeof(a=a[g.name]):continue}for(var l=0;d=a[l];l++)if("number"===typeof d.data||d.type===g.name)switch(c=d.data,b?typeof b:String(b)){case "number":if((e=r[c])&&c===b&&(p=n.call(this,e))!==s)return p;break;case "string":case "":if((e=r[c])&&h.test(d.namespace)&&
(p=n.call(this,e))!==s)return p;break;default:if((e=r[c])&&(p=n.call(this,e))!==s)return p}}if(f&&(p=n.call(this))!==s)return p}return this},redirect:function(b,n,f,r){var e,c,h,p;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":c=g.ids;n=g.settings;for(var a=0;b=c[a];a++)if((e=
n[b])&&(p=f.call(this,e))!==s)return p;if(r&&(p=f.call(this))!==s)return p;break;case "direct:number":case "number":n=g.settings;if((e=n[b])&&(p=f.call(this,e))!==s||r&&(p=f.call(this))!==s)return p;break;case "direct:string":case "direct:":c=g.ids;n=g.settings;b=b.split(".").sort().join(".");h=RegExp("string"===typeof b?b&&"(?:^|.)"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");for(a=0;b=c[a];a++)if((e=n[b])&&h.test(e.nss.name)&&(p=f.call(this,e))!==s)return p;if(r&&(p=f.call(this))!==
s)return p;break;case "string":case "":this.trigger(g.name+(b?"."+b:""),[f,n]);break;case "undefined":case "null":case "0":this.trigger(g.name,[f,n]);break;case "boolean":this.trigger(g.name,[f,!0]);break;case "false":this.trigger(g.name,[f,!1])}return this},setAlias:function(b){g.alias="string"===typeof b?b:g.alias;g.name===g.alias||k[g.alias]||(k[g.name][g.alias]=k.fn[g.name],k.fn[g.alias]=k[g.alias]=k.fn[g.name])},setProperties:function(b,n){var f=this;if(f instanceof k||f===k[g.name])f=f instanceof
k&&n!==s?f.add(n):f,f.vtUID=++g.count,f.vtNamespace="string"===typeof b?b:null,f[g.name]=k[g.name],f.isRegistrate=function(b){return!0===g.search.call(this,b,function(b){return!0})},f.enable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!0}),this},f.disable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!1}),this},f.reset=function(b,e){return g.redirect.call(this,b,e,function(b){this.release(b.id)[g.name](b.option)}),this},f.release=function(b,
e){return g.redirect.call(this,b,e,function(b){g.terminate(b)}),this},f.vtrigger=function(b,e,c){c="string"===typeof b?b.split(/[,\s]\s*/):[b];for(var f=0,n=c.length;f<n;f++)b=c[f],g.redirect.call(this,b,e,function(b,c){k(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[c])});return this};return f},relations:function(b,n,f){var r,e;e=b.split(".");r=k();for(var c=0,h=e.length;c<h;c++)b=e[c],n&&(g.relations[b]=f?(g.relations[b]||k()).not(n):(g.relations[b]||k()).add(n)),r=r.add(g.relations[b]);
return r},registrate:function(b,g,f,r,e,c){var h,p,a;h=this;a=e.ids;p=e.settings;var d,k;d=b(g);k=b(f);k=d.add(k);[].slice.call(arguments);for(var l=0;2>l;l++)h=h[l]===g?h.not(g).add(f):h;for(var l=0,t,q;q=h[l];l++){t=b(q);if(c.terminate&&!t.find(c.trigger)[0])break;if(e.search.call(t[e.name](),c.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return e.redirect.call(this,a.nss.name,!1,function(a){b.extend(!0,a,a.reset)}),
!1;default:return!1}})&&(c=b.extend(!0,{},c),c.id=p.length,c.context=q,a.push(c.id),p[c.id]=c,b.data(q,c.nss.data,c.id),(c.root||c.extend)&&e.relations(c.nss.name,q),!c.multi&&t.find(c.trigger).removeData(c.nss.data_fired),t.bind(c.nss.event,c.id,function(a,c,d){e.countEvent++;var h,l,k,p,q,t,v;h=e.settings[a.data];k=a;q=!0;if(h){switch(c&&typeof c||c){case "function":return v=c,l=d,!l&&k.stopPropagation(),(l||k.target===k.currentTarget)&&v.apply(b(this)[e.name](),[h].concat([].slice.call(arguments,
3)));case "object":l=c,q=!1;default:p=q?0===c?f:k.target:l.target,v=arguments.callee,k.stopPropagation()}b(h.trigger,a.currentTarget).first().is(":hidden")||(t=Number(Boolean(p.parentNode)),function(a,c,d,m){var h=m.queue[t];switch(!0){case !e.settings[m.id]:case !m.status.active:case 3<h.length:break;case m.id!==b.data(a.currentTarget,m.nss.data):b(a.currentTarget)[e.name]().release(m.id);break;default:if(q||!m.delay&&!m.interval){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,r,e,
a,c,d,m)}else{var k,l;for(l=m.interval?(new Date).getTime()-m.timestamp:0;k=h.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,r,e,a,c,d,m)},Math.max(m.delay,m.interval-l,20));h.push(k)}}}(k,l,p,h))}}),t.not(f).bind(c.nss.scroll,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(c.nss.resize,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];
c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}),!(0<l))){var v=0;k.not(q).bind(c.nss.event,c.nss.event,function(a){e.countRedirect++;var c=a.data,d;if(a.target===g)b(f).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===f){var h=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(h);break;case "undefind":d.push(h)}1>v&&(v++,e.relations(c.replace(/^\w+\.?/,"")).filter(h?a.target:"*").not(f).trigger(c,
d),v--)}a.stopPropagation()});c.nss.alias&&k.bind(c.nss.alias,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(c.root||c.extend)&&d.bind(c.nss.scroll,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(c.nss.resize,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}},drive:function(b,g,f,k,e,c,h,
p,a,d){e.countDrive++;var s,l,t,q,v,m,w,y,x,u;d=d||{};s=d.context=d.update?d.context:b(c.currentTarget);l=d.eventcontext=d.update?d.eventcontext:b(p);d.root=d.update?d.root:!s.parent()[0];t=d.layer=d.update?d.layer:Number(Boolean(l.parent()[0]));m=v=q=!1;w=d.targets=d.update&&a.step?d.targets:s.find(a.trigger);w=d.targets=0<=a.index||w.length>a.index?d.targets:s.find(a.trigger);y=d.evtScroll=d.update?d.evtScroll:l.scrollTop();l=d.evtHeight=d.update?d.evtHeight:a.height[t];x=d.direction=d.update?d.direction:
y===l?a.direction:y<l?-1:1;u=d.distance=d.update?d.distance:Math.abs(y-l);l=w.eq(a.index);a.direction!==x&&(a.turn=!0,a.end=!1,a.direction=x,a.index=0>a.index?0:w.length<=a.index?w.length-1:a.index,l=w.eq(a.index));a.distance=0===u?a.distance:u;a.height[t]=y;switch(!0){case 0>a.index||w.length<=a.index:break;case !w.length||!l[0]:break;default:var z,A,C,D,E;m=d.$win=d.update?d.$win:b(g);v=d.winTop=d.update?d.winTop:m.scrollTop();m=d.winHeight=d.update?d.winHeight:m.height();y=v+m;var B,H,F,G;u=a.ahead[0];
x=d.aheadTop=d.update?d.aheadTop:"number"===typeof u?parseInt(u,10):parseInt(eval(m+u),10);u=a.ahead[1];B=d.aheadBottom=d.update?d.aheadBottom:"number"===typeof u?parseInt(u,10):parseInt(eval(m+u),10);H=d.beforehand=d.beforehand?d.beforehand:0>a.beforehand?w.length+a.beforehand+1:a.beforehand;z=s;a.root?(u=d.frameTop=d.update?d.frameTop:v,m=d.frameHeight=d.update?d.frameHeight:m):(u=d.frameTop=d.update?d.frameTop:parseInt(z.offset().top,10),m=d.frameHeight=d.update?d.frameHeight:z.outerHeight());
z=u+m;D=d.visibleTop=d.update?d.visibleTop:Math.max(u,v);E=d.visibleBottom=d.update?d.visibleBottom:Math.min(z,y);A=parseInt(l.offset().top,10);m=l.outerHeight();C=A+m;F=E>=A-B;G=D<=C+x;m=1===a.direction?F:G;switch(!0){case a.first&&H>a.index&&(a.multi||!b.data(l[0],a.nss.data_fired)):H>a.index&&(q=m=!0);break;case t?!1:D>z+B||E<u-x:m=1===a.direction?D>z&&z>A-B:E<u&&u<C+x;break;case !a.skip&&!a.multi:q=1===a.direction?F:G;break;case a.skip&&!a.multi:q=F&&G;break;case !a.skip&&a.multi:q=1===a.direction?
F:G;a.first||h&&"resize"===h.type||(q=1===a.direction?(t?E>A+a.distance-x:y>A+a.distance-x)?!1:q:(t?D<C-a.distance+B:v<C-a.distance+B)?!1:q);break;case a.skip&&a.multi:q=F&&G,a.first||h&&"resize"===h.type||(q=1===a.direction?(t?E>A+a.distance-x:y>A+a.distance-x)?!1:q:(t?D<C-a.distance+B:v<C-a.distance+B)?!1:q)}v=a.step?a.step*a.direction:q?-1===a.direction&&-1||0:a.direction;q&&!a.multi&&(q=l[0]&&b.data(l[0],a.nss.data_fired)?!1:q,q=a.turn&&!d.recursion?!1:q)}if(q){if(a.interval){var I=(new Date).getTime();
if(a.interval<=I-a.timestamp)a.timestamp=I;else return function(a,c,d){var e=setTimeout(function(){b(a.currentTarget).trigger(d.nss.event,[c])},Math.max(d.interval-I+d.timestamp,20));d.queue[t].push(e)}(c,h,a),!0}e.countCallback++;++a.count&&b.data(l[0],a.nss.data_fired,a.id);!1===a.callback.apply(l[0],[c,h,{contaner:s[0],activator:p,selector:a.trigger,index:a.index,direction:a.direction,distance:a.distance,relations:a.root||a.extend?e.relations(a.nss.name):null,parameter:a.parameter}])&&a.count--&&
b.removeData(l[0],a.nss.data_fired)}if(a.terminate&&(!w.length||!a.multi&&a.step&&a.count>=w.length))return s[e.name]().release(a.id),!0;a.index+=m?v:0;d.update=d.update||a.cache;d.recursion?m&&arguments.callee.apply(this,arguments):(d.recursion=!0,m&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));a.first=!1;a.turn=!1;d.recursion=!1;return!0},terminate:function(b){var n,f;f=b.context;n=k(f);k.removeData(f,b.nss.data);!b.multi&&n.find(b.trigger).removeData(b.nss.data_fired);n.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);
if(b.root||b.extend)g.relations(b.nss.name,n,!0)[0]||k(K).unbind(b.nss.scroll).unbind(b.nss.resize).add(L).unbind(b.nss.event).unbind(b.nss.alias);n=g.ids;for(var r=n.length;f=n[--r];)if(f===b.id){n.splice(r,1);g.settings[f]=s;break}}};(function(b,g,f,k,e){b.fn[e.name]=b[e.name]=function(){return M.apply(this,[b,g,f,k,e].concat([].slice.call(arguments)))};e.setProperties.call(b[e.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,window,document,void 0);
