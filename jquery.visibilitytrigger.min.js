/*
 * 
 * visibility trigger
 * 
 * ---
 * @Copyright(c) 2012, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.0.3
 * @updated 2013/11/30
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(p,J,K,s){function L(b,q,h,g,e,c){var f=this;switch(!0){case "object"===typeof c&&(b(c,h)[0]||c===q||c===h):return f=f instanceof b?f.add(c):b(c),e.setProperties.call(f,null,e),f;case "object"===typeof c:f=f instanceof b?f.add():b(h);e.setAlias(c.gns);e.setProperties.call(f,c.ns||"",e);if(!c.trigger||!c.callback)return f;break;default:return f=f instanceof b?f.add():f,e.setAlias(c),e.setProperties.call(f,null,e),f}c="object"===typeof c&&b.extend(!0,{gns:e.name,ns:null,context:null,trigger:null,
callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},c,{id:0,nss:null,root:!f.parent()[0],first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[],status:{active:!0},timestamp:0,option:c});c.nss={array:[e.name].concat(c.ns&&String(c.ns).split(".")||[])};b.extend(!0,c,{nss:{name:c.ns||"",event:c.nss.array.join("."),alias:e.alias?[e.alias].concat(c.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(c.nss.array.join(":")).join("."),
resize:["resize"].concat(c.nss.array.join(":")).join("."),data:c.nss.array.join("-"),data_fired:c.nss.array.concat("fired").join("-")},ahead:typeof c.ahead in{string:0,number:0}?[c.ahead,c.ahead]:g});e.registrate.call(f,b,q,h,g,e,c);return f}function H(b){var q=[].slice.call(arguments,1);return function(){b.apply(this,q.concat([].slice.call(arguments)))}}var g;g={name:"visibilitytrigger",alias:"vt",ids:[0],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,
search:function(b,q,h){var v,e,c,f,l;!b&&""!==b&&this.vtUID&&this instanceof p&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof p?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,b,!1,q);case "string":case "":f=RegExp("string"===typeof b?b&&"^"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,
"\\$1")+"(?:$|.)"||"^$":"");case "undefined":case "null":case "0":case "boolean":case "false":var a,d;v=g.settings;for(var w=0;c=this[w];w++){switch(!0){case "object"!==typeof(a=p.data(c,"events")):case !a||"object"!==typeof(a=a[g.name]):continue}for(var m=0;d=a[m];m++)if("number"===typeof d.data||d.type===g.name)switch(c=d.data,b?typeof b:String(b)){case "number":if((e=v[c])&&c===b&&(l=q.call(this,e))!==s)return l;break;case "string":case "":if((e=v[c])&&f.test(d.namespace)&&(l=q.call(this,e))!==
s)return l;break;default:if((e=v[c])&&(l=q.call(this,e))!==s)return l}}if(h&&(l=q.call(this))!==s)return l}return this},redirect:function(b,q,h,v){var e,c,f,l;!b&&""!==b&&this.vtUID&&this instanceof p&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof p?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":c=g.ids;q=g.settings;for(var a=1;b=c[a];a++)if((e=q[b])&&(l=h.call(this,
e))!==s)return l;if(v&&(l=h.call(this))!==s)return l;break;case "direct:number":case "number":q=g.settings;if((e=q[b])&&(l=h.call(this,e))!==s||v&&(l=h.call(this))!==s)return l;break;case "direct:string":case "direct:":c=g.ids;q=g.settings;f=RegExp("string"===typeof b?b&&"^"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");for(a=1;b=c[a];a++)if((e=q[b])&&f.test(e.nss.name)&&(l=h.call(this,e))!==s)return l;if(v&&(l=h.call(this))!==s)return l;break;case "string":case "":this.trigger(g.name+
(b?"."+b:""),[h,q]);break;case "undefined":case "null":case "0":case "boolean":case "false":this.trigger(g.name,[h,q])}return this},setAlias:function(b){g.alias="string"===typeof b?b:g.alias;g.name===g.alias||p[g.alias]||(p.fn[g.alias]=p[g.alias]=p.fn[g.name])},setProperties:function(b){this.vtUID=++g.count;this.vtNamespace="string"===typeof b?b:null;this.isRegistrate=function(b){var h=RegExp("string"===typeof b?b&&"^"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");return!0===
g.search.call(this,b,function(b){if(h.test(b.nss.name))return!0})};this.enable=function(b,h){return g.redirect.call(this,b,h,function(b){b.status.active=!0}),this};this.disable=function(b,h){return g.redirect.call(this,b,h,function(b){b.status.active=!1}),this};this.reset=function(b,h){var v=RegExp("string"===typeof b?b&&"^"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");return g.redirect.call(this,b,h,function(b){if(v.test(b.nss.name))this.release(b.id)[g.name](b.option)}),this};
this.release=function(b,h){return g.redirect.call(this,b,h,function(b){g.terminate(b)}),this};this.vtrigger=function(b,h,v){v="string"===typeof b?b.split(/,\s*/):[b];for(var e=0,c=v.length;e<c;e++)b=v[e],g.redirect.call(this,b,h,function(b,c){p(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[c])});return this}},registrate:function(b,g,h,v,e,c){var f,l,a,d;f=this;d=e.ids;l=e.settings;var w,m;w=b(g);a=b(h);m=w.add(a);[].slice.call(arguments);for(var r=0;2>r;r++)f=f[r]===g?f.not(g).add(h):
f;for(var r=0,k,t;t=f[r];r++){k=b(t)[e.name]();if(c.terminate&&!k.find(c.trigger)[0])break;if(e.search.call(k,c.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return e.redirect.call(k,a.nss.name,!1,function(a){b.extend(!0,a,a.reset)}),!1;default:return!1}})){c=b.extend(!0,{},c);c.id=l.length;c.context=t;d.push(c.id);l[c.id]=c;b.data(t,c.nss.data,c.id);if(c.root||c.extend)a=e.relations[c.nss.name],e.relations[c.nss.name]=
a?a=a.add(k):a=k;!c.multi&&k.find(c.trigger).removeData(c.nss.data_fired);k.bind(c.nss.event,c.id,function(a,c,d){e.countEvent++;var f,k,l,m,n,r,t;f=e.settings[a.data];l=a;n=!0;if(f){switch(c&&typeof c||c){case "function":return t=c,!d&&l.stopPropagation(),t.apply(b(this)[e.name](),[f].concat([].slice.call(arguments,3)));case "object":k=c,n=!1;default:m=n?0===c?h:l.target:k.target,t=arguments.callee,l.stopPropagation()}if(!b(f.trigger,m).first().is(":hidden"))if(r=new H(function(a,c,d,f){switch(!0){case !e.settings[f.id]:case !f.status.active:break;
case f.id!==b.data(a.currentTarget,f.nss.data):b(a.currentTarget)[e.name]().release(f.id);break;default:e.drive(b,g,h,v,e,a,c,d,f)}},l,k,m),n||!f.delay)r=r(f);else{for(var u;u=f.queue.shift();)clearTimeout(u);u=setTimeout(function(){if(f){for(;u=f.queue.shift();)clearTimeout(u);e.countTask++;r=f&&r(f)}},f.delay);f.queue.push(u)}}});k.not(h).bind(c.nss.scroll,c.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(c.nss.resize,
c.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()});if(!(0<r)){var n=0;m.not(t).bind(c.nss.event,c.nss.event,function(a){e.countRedirect++;var c=a.data,d;if(a.target===g)b(h).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===h){var f=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(f);break;case "undefind":d.push(f)}!n++&&b(e.relations[c.replace(/^\w+\.?/,
"")||""]).filter(f?a.target:"*").not(h).trigger(c,d);n--}a.stopPropagation()});c.nss.alias&&m.bind(c.nss.alias,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(c.root||c.extend)&&w.bind(c.nss.scroll,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(c.nss.resize,c.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}}},
drive:function(b,g,h,v,e,c,f,l,a,d){e.countDrive++;var w,m,r,k,t,n,p,s,A,B;d=d||{};w=d.context=d.update?d.context:b(c.currentTarget);m=d.eventcontext=d.update?d.eventcontext:b(l);root=d.root=d.update?d.root:!w.parent()[0];r=d.layer=d.update?d.layer:Number(Boolean(m.parent()[0]));n=t=k=!1;p=d.targets=d.update&&a.step?d.targets:w.find(a.trigger);p=d.targets=0<=a.index||p.length>a.index?d.targets:w.find(a.trigger);s=d.evtScroll=d.update?d.evtScroll:m.scrollTop();m=d.evtHeight=d.update?d.evtHeight:a.height[r];
A=d.direction=d.update?d.direction:s===m?a.direction:s<m?-1:1;B=d.distance=d.update?d.distance:Math.abs(s-m);m=p.eq(a.index);a.direction!==A&&(a.turn=!0,a.end=!1,a.direction=A,a.index=0>a.index?0:p.length<=a.index?p.length-1:a.index,m=p.eq(a.index));a.distance=0===B?a.distance:B;a.height[r]=s;switch(!0){case !p.length||!m[0]:break;case 0>a.index||p.length<=a.index:break;default:var y,x,z,C,D,E;n=d.$win=d.update?d.$win:b(g);t=d.winTop=d.update?d.winTop:n.scrollTop();n=d.winHeight=d.update?d.winHeight:
n.height();s=t+n;var u,F,G;x=Math.max(0,a.direction);A=d.aheadTop=d.update?d.aheadTop:-1<=a.ahead[0]&&1>=a.ahead[0]?parseInt(n*a.ahead[0],10):parseInt(a.ahead[0],10);B=d.aheadBottom=d.update?d.aheadBottom:-1<=a.ahead[1]&&1>=a.ahead[1]?parseInt(n*a.ahead[1],10):parseInt(a.ahead[1],10);u=x?B:A;y=w;a.root?(x=d.frameTop=d.update?d.frameTop:t,n=d.frameHeight=d.update?d.frameHeight:n):(x=d.frameTop=d.update?d.frameTop:parseInt(y.offset().top,10),n=d.frameHeight=d.update?d.frameHeight:y.outerHeight());y=
x+n;D=d.visibleTop=d.update?d.visibleTop:Math.max(x,t);E=d.visibleBottom=d.update?d.visibleBottom:Math.min(y,s);z=parseInt(m.offset().top,10);n=m.outerHeight();C=z+n;F=E>=z-B;G=D<=C+A;n=1===a.direction?F:G;switch(!0){case r?!1:D>y+u||E<x-u:n=1===a.direction?D>y&&y>=z-B:E<x&&x<=C+A;break;case a.first&&a.beforehand>a.index&&(a.multi||!b.data(m[0],a.nss.data_fired)):a.beforehand>a.index?k=n=!0:a.beforehand=0;break;case !a.skip&&!a.multi:k=1===a.direction?F:G;break;case a.skip&&!a.multi:k=F&&G;break;
case !a.skip&&a.multi:k=1===a.direction?F:G;a.first||f&&"resize"===f.type||(k=1===a.direction?(r?E>z+a.distance-u:s>z+a.distance-u)?!1:k:(r?D<C-a.distance+u:t<C-a.distance+u)?!1:k);break;case a.skip&&a.multi:k=F&&G,a.first||f&&"resize"===f.type||(k=1===a.direction?(r?E>z+a.distance-u:s>z+a.distance-u)?!1:k:(r?D<C-a.distance+u:t<C-a.distance+u)?!1:k)}t=a.step?a.step*a.direction:k?0:a.direction;k&&!a.multi&&(k=m[0]&&b.data(m[0],a.nss.data_fired)?!1:k,k=a.turn&&!d.recursion?!1:k)}if(k){if(a.interval)if(r=
(new Date).getTime(),a.interval<=r-a.timestamp)a.timestamp=r;else{var I=new H(function(a,c,d){b(a.currentTarget).trigger(d.nss.event,[c])},c,f);id=setTimeout(function(){I=a&&I(a)},Math.max(a.interval-r+a.timestamp,50));a.queue.push(id);return!0}e.countCallback++;!a.multi&&++a.count&&b.data(m[0],a.nss.data_fired,a.id);!1===a.callback.apply(m[0],[c,f,{contaner:w[0],activator:l,selector:a.trigger,index:a.index,direction:a.direction,distance:a.distance,relations:a.root||a.extend?e.relations[a.nss.name]:
null,parameter:a.parameter}])&&!a.multi&&a.count--&&b.removeData(m[0],a.nss.data_fired)&&(k=!1)}if(a.terminate&&(!p.length||a.step&&a.count>=p.length))return w[e.name]().release(a.id),!0;a.index+=n?t:0;d.update=d.update||a.cache;d.recursion?n&&arguments.callee.apply(this,arguments):(d.recursion=!0,n&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));a.first=!1;a.turn=!1;d.recursion=!1;return!0},terminate:function(b){var q,h;h=b.context;q=p(h);p.removeData(h,b.nss.data);!b.multi&&
q.find(b.trigger).removeData(b.nss.data_fired);q.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);if(b.root||b.extend)h=g.relations[b.nss.name],g.relations[b.nss.name]=h=h.not(q),h[0]||p(J).unbind(b.nss.scroll).unbind(b.nss.resize).add(K).unbind(b.nss.event).unbind(b.nss.alias);ids=g.ids;for(q=ids.length;id=ids[--q];)if(id===b.id){ids.splice(q,1);g.settings[id]=s;break}}};(function(b,g,h,p,e){b.fn[e.name]=b[e.name]=function(){return L.apply(this,[b,g,h,p,e].concat([].slice.call(arguments)))};
e.setProperties.call(b[e.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,window,document,void 0);
