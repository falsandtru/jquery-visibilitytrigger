/*! jquery.visibilitytrigger.js v0.4.0 | (c) 2012, falsandtru | MIT Licence */
(function(k,J,K,r){function L(b,g,f,q,e,a){var h=this;switch(!0){case g===a:case f===a:case b.contains(f,"object"===typeof a&&a||null):return h=h instanceof b?h:b(),e.setProperties.call(h,null,a);case "object"===typeof a:e.setAlias(a.gns);h=h instanceof b?h:b(f);h=e.setProperties.call(h,a.ns||"",null);if(!a.trigger||!a.callback)return h;break;default:return e.setAlias(a),h=h instanceof b?h:b[e.name],e.setProperties.call(h,null,null)}a="object"===typeof a&&b.extend(!0,{gns:e.name,ns:null,trigger:null,
callback:function(){},parameter:[],ahead:0,beforehand:0,step:1,multi:!1,skip:!1,extend:!0,cache:!0,delay:300,interval:0,reset:!0,terminate:!0},a,{id:0,nss:null,context:null,root:!h.parent().length,first:!0,index:0,count:0,height:[0,0],direction:1,distance:0,turn:!1,end:!1,queue:[[],[]],status:{active:!0},timestamp:0,option:a});a.ns=a.ns&&"."===a.ns[0]?a.ns.slice(1):a.ns;a.nss={array:[e.name].concat(a.ns&&String(a.ns).split(".")||[])};b.extend(!0,a,{nss:{name:a.ns||"",event:a.nss.array.join("."),alias:e.alias?
[e.alias].concat(a.nss.array.slice(1)).join("."):!1,scroll:["scroll"].concat(a.nss.array.join(":")).join("."),resize:["resize"].concat(a.nss.array.join(":")).join("."),data:a.nss.array.join("-"),data_fired:a.nss.array.concat("fired").join("-")},ahead:a.ahead instanceof Array?a.ahead.concat(a.ahead).slice(0,2):[a.ahead,a.ahead],beforehand:"boolean"===typeof a.beforehand?-Number(a.beforehand):a.beforehand});a.ahead[0]=1>Math.abs(a.ahead[0])?"*"+10*a.ahead[0]:a.ahead[0];a.ahead[1]=1>Math.abs(a.ahead[1])?
"*"+10*a.ahead[1]:a.ahead[1];e.registrate.call(h,b,g,f,q,e,a);return h}var g;g={name:"visibilitytrigger",alias:"vt",ids:[],settings:[0],relations:{},count:0,countTask:0,countDrive:0,countEvent:0,countRedirect:0,countCallback:0,search:function(b,n,f){var q,e,a,h,l;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":case "direct:number":case "number":case "direct:string":case "direct:":return g.redirect.call(this,
b,!1,n);case "string":case "":b=b.split(".").sort().join("."),h=new RegExp("string"===typeof b?b&&"(?:^|.)"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");case "undefined":case "null":case "0":case "boolean":case "false":var c,d;q=g.settings;for(var I=0;a=this[I];I++){switch(!0){case "object"!==typeof(c=k._data(a,"events")):case !c||"object"!==typeof(c=c[g.name]):continue}for(var t=0;d=c[t];t++)if("number"===typeof d.data||d.type===g.name)switch(a=d.data,b?typeof b:String(b)){case "number":if((e=
q[a])&&a===b&&(l=n.call(this,e))!==r)return l;break;case "string":case "":if((e=q[a])&&h.test(d.namespace)&&(l=n.call(this,e))!==r)return l;break;default:if((e=q[a])&&(l=n.call(this,e))!==r)return l}}if(f&&(l=n.call(this))!==r)return l}return this},redirect:function(b,n,f,q){var e,a,h,l;!b&&""!==b&&this.vtUID&&this instanceof k&&"string"===typeof this.vtNamespace&&(b=this.vtNamespace);switch(this instanceof k?b?typeof b:String(b):"direct:"+(b?typeof b:String(b))){case "direct:undefined":case "direct:boolean":case "direct:false":case "direct:null":case "direct:0":a=
g.ids;n=g.settings;for(var c=0;b=a[c];c++)if((e=n[b])&&(l=f.call(this,e))!==r)return l;if(q&&(l=f.call(this))!==r)return l;break;case "direct:number":case "number":n=g.settings;if((e=n[b])&&(l=f.call(this,e))!==r||q&&(l=f.call(this))!==r)return l;break;case "direct:string":case "direct:":a=g.ids;n=g.settings;b=b.split(".").sort().join(".");h=new RegExp("string"===typeof b?b&&"(?:^|.)"+b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"(?:$|.)"||"^$":"");for(c=0;b=a[c];c++)if((e=n[b])&&h.test(e.nss.name)&&
(l=f.call(this,e))!==r)return l;if(q&&(l=f.call(this))!==r)return l;break;case "string":case "":this.trigger(g.name+(b?"."+b:""),[f,n]);break;case "undefined":case "null":case "0":this.trigger(g.name,[f,n]);break;case "boolean":this.trigger(g.name,[f,!0]);break;case "false":this.trigger(g.name,[f,!1])}return this},setAlias:function(b){g.alias="string"===typeof b?b:g.alias;g.name===g.alias||k[g.alias]||(k[g.name][g.alias]=k.fn[g.name],k.fn[g.alias]=k[g.alias]=k.fn[g.name])},setProperties:function(b,
n){var f=this;if(f instanceof k||f===k[g.name])f=f instanceof k&&n!==r?f.add(n):f,f.vtUID=++g.count,f.vtNamespace="string"===typeof b?b:null,f[g.name]=k[g.name],f.isRegistrate=function(b){return!0===g.search.call(this,b,function(b){return!0})},f.enable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!0}),this},f.disable=function(b,e){return g.redirect.call(this,b,e,function(b){b.status.active=!1}),this},f.reset=function(b,e){return g.redirect.call(this,b,e,function(b){this.release(b.id)[g.name](b.option)}),
this},f.release=function(b,e){return g.redirect.call(this,b,e,function(b){g.terminate(b)}),this},f.vtrigger=function(b,e,a){a="string"===typeof b?b.split(/[,\s]\s*/):[b];for(var f=0,n=a.length;f<n;f++)b=a[f],g.redirect.call(this,b,e,function(b,a){k(b.context).trigger(g.name+(b.nss.name?"."+b.nss.name:""),[a])});return this};return f},relations:function(b,n,f){var q,e;e=b.split(".");q=k();for(var a=0,h=e.length;a<h;a++)b=e[a],n&&(g.relations[b]=f?(g.relations[b]||k()).not(n):(g.relations[b]||k()).add(n)),
q=q.add(g.relations[b]);return q},registrate:function(b,g,f,q,e,a){var h,l,c;h=this;c=e.ids;l=e.settings;var d,k;d=b(g);k=b(f);k=d.add(k);[].slice.call(arguments);for(var t=0;2>t;t++)h=h[t]===g?h.not(g).add(f):h;for(var t=0,s,p;p=h[t];t++){s=b(p);if(a.terminate&&!s.find(a.trigger).length)break;if(e.search.call(s[e.name](),a.nss.name,function(a){switch(a.reset&&typeof a.reset||a.reset){case "boolean":return this.release(a.nss.name),!0;case "object":return e.redirect.call(this,a.nss.name,!1,function(a){b.extend(!0,
a,a.reset)}),!1;default:return!1}})&&(a=b.extend(!0,{},a),a.id=l.length,a.context=p,c.push(a.id),l[a.id]=a,b.data(p,a.nss.data,a.id),(a.root||a.extend)&&e.relations(a.nss.name,p),!a.multi&&s.find(a.trigger).removeData(a.nss.data_fired),s.bind(a.nss.event,a.id,function(a,c,d){e.countEvent++;var h,k,l,p,u,t,s;h=e.settings[a.data];l=a;u=!0;if(h){switch(c&&typeof c||c){case "function":return s=c,k=d,!k&&l.stopPropagation(),(k||l.target===l.currentTarget)&&s.apply(b(this)[e.name](),[h].concat([].slice.call(arguments,
3)));case "object":k=c,u=!1;default:p=u?0===c?f:l.target:k.target,s=arguments.callee,l.stopPropagation()}t=Number(Boolean(p.parentNode));(function(a,c,d,m){var h=m.queue[t];switch(!0){case !e.settings[m.id]:case !m.status.active:case 3<h.length:break;case m.id!==b.data(a.currentTarget,m.nss.data):b(a.currentTarget)[e.name]().release(m.id);break;default:if(u||!m.delay&&!m.interval){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,q,e,a,c,d,m)}else{var k,l;for(l=m.interval?(new Date).getTime()-
m.timestamp:0;k=h.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=h.shift();)clearTimeout(k);e.countTask++;e.drive(b,g,f,q,e,a,c,d,m)},Math.max(m.delay,m.interval-l,20));h.push(k)}}})(l,k,p,h)}}),s.not(f).bind(a.nss.scroll,a.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,[a]);a.stopPropagation()}).bind(a.nss.resize,a.id,function(a){e.countRedirect++;var c=e.settings[a.data];c&&c.status.active&&b(a.currentTarget).trigger(c.nss.event,
[a]);a.stopPropagation()}),!(0<t))){var w=0;k.not(p).bind(a.nss.event,a.nss.event,function(a){e.countRedirect++;var c=a.data,d;if(a.target===g)b(f).trigger(c,[].slice.call(arguments,1));else if(a.currentTarget===f){var h=Number(Boolean(a.target!==a.currentTarget));d=[].slice.call(arguments,1);switch(typeof d[0]){case "function":d.push(h);break;case "undefind":d.push(h)}1>w&&(w++,e.relations(c.replace(/^\w+\.?/,"")).filter(h?a.target:"*").not(f).trigger(c,d),w--)}a.stopPropagation()});a.nss.alias&&
k.bind(a.nss.alias,a.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.target).trigger(c,[].slice.call(arguments,1));a.stopPropagation()});(a.root||a.extend)&&d.bind(a.nss.scroll,a.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()}).bind(a.nss.resize,a.nss.event,function(a){e.countRedirect++;var c=a.data;b(a.currentTarget).trigger(c,[a]);a.stopPropagation()})}}},drive:function(b,g,f,k,e,a,h,l,c,d){e.countDrive++;var r,t,s,p,w,m,x,v,y,
A,B;d=d||{};r=d.context=d.update?d.context:b(a.currentTarget);t=d.eventcontext=d.update?d.eventcontext:b(l);d.root=d.update?d.root:!r.parent().length;s=d.layer=d.update?d.layer:Number(Boolean(t.parent().length));m=w=p=!1;x=d.targets=d.update&&c.step?d.targets:r.find(c.trigger);x=d.targets=0<=c.index||x.length>c.index?d.targets:r.find(c.trigger);y=d.evtScroll=d.update?d.evtScroll:t.scrollTop();t=v=d.evtHeight=d.update?d.evtHeight:c.height[s];A=d.direction=d.update?d.direction:y===v?c.direction:y<v?
-1:1;B=d.distance=d.update?d.distance:Math.abs(y-v);v=x.eq(c.index);c.direction!==A&&(c.turn=!0,c.end=!1,c.direction=A,c.index=0>c.index?0:x.length<=c.index?x.length-1:c.index,v=x.eq(c.index));c.distance=0===B?c.distance:B;c.height[s]=y;switch(!0){case 0>c.index||x.length<=c.index:case !x.length||!v.length:break;default:var z,u,C,F;y=d.$win=d.update?d.$win:b(g);w=d.winTop=d.update?d.winTop:y.scrollTop();z=d.winHeight=d.update?d.winHeight:y.height();y=w+z;var G,D,E;m=c.ahead[0];A=d.aheadTop=d.update?
d.aheadTop:"string"===typeof m&&"*"===m[0]?parseInt(z*m.slice(1),10):parseInt(m,10);m=c.ahead[1];B=d.aheadBottom=d.update?d.aheadBottom:"string"===typeof m&&"*"===m[0]?parseInt(z*m.slice(1),10):parseInt(m,10);G=d.beforehand=d.beforehand?d.beforehand:0>c.beforehand?x.length+c.beforehand+1:c.beforehand;u=r;c.root?(m=d.frameTop=d.update?d.frameTop:w,z=d.frameHeight=d.update?d.frameHeight:z):(m=d.frameTop=d.update?d.frameTop:parseInt(u.offset().top,10),z=d.frameHeight=d.update?d.frameHeight:u.outerHeight());
u=m+z;z=d.visibleTop=d.update?d.visibleTop:Math.max(m,w);F=d.visibleBottom=d.update?d.visibleBottom:Math.min(u,y);u=parseInt(v.offset().top,10);m=v.outerHeight();C=u+m;D=F>=u-B;E=z<=C+A;m=1===c.direction?D:E;switch(!0){case c.first&&G>c.index&&(c.multi||!b.data(v[0],c.nss.data_fired)):G>c.index&&(p=m=!0);break;case !c.skip&&!c.multi:p=1===c.direction?D:E;break;case c.skip&&!c.multi:p=D&&E;break;case !c.skip&&c.multi:p=1===c.direction?D:E;!p||c.first||h&&"resize"===h.type||(p=1===c.direction?(s?F>=
u+c.distance-B:y>=u+c.distance-B)?!1:p:(s?z<=C-c.distance+A:w<=C-c.distance+A)?!1:p);break;case c.skip&&c.multi:p=D&&E,!p||c.first||h&&"resize"===h.type||(p=1===c.direction?(s?F>=u+c.distance-B:y>=u+c.distance-B)?!1:p:(s?z<=C-c.distance+A:w<=C-c.distance+A)?!1:p)}w=c.step?c.step*c.direction:p?-1===c.direction&&-1||0:c.direction;p=p&&!c.multi&&b.data(v[0],c.nss.data_fired)?!1:p}if(p){if(c.interval){var H=(new Date).getTime();if(c.interval<=H-c.timestamp)c.timestamp=H;else return function(a,c,d){var e=
setTimeout(function(){b(a.currentTarget).trigger(d.nss.event,[c])},Math.max(d.interval-H+d.timestamp,20));d.queue[s].push(e)}(a,h,c),c.height[s]=t,!0}e.countCallback++;++c.count&&b.data(v[0],c.nss.data_fired,c.id);!1===c.callback.apply(v[0],[a,h,{container:r[0],activator:l,selector:c.trigger,index:c.index,direction:c.direction,distance:c.distance,relations:c.root||c.extend?e.relations(c.nss.name):null,parameter:c.parameter}])&&c.count--&&b.removeData(v[0],c.nss.data_fired)}if(c.terminate&&(!x.length||
!c.multi&&c.step&&c.count>=x.length))return r[e.name]().release(c.id),!0;c.index+=m?w:0;d.update=d.update||c.cache;d.recursion?m&&arguments.callee.apply(this,arguments):(d.recursion=!0,m&&arguments.callee.apply(this,[].slice.call(arguments).concat([d])));c.first=!1;c.turn=!1;d.recursion=!1;return!0},terminate:function(b){var n,f;f=b.context;n=k(f);k.removeData(f,b.nss.data);!b.multi&&n.find(b.trigger).removeData(b.nss.data_fired);n.unbind(b.nss.event).unbind(b.nss.scroll).unbind(b.nss.resize);if(b.root||
b.extend)g.relations(b.nss.name,n,!0).length||k(J).unbind(b.nss.scroll).unbind(b.nss.resize).add(K).unbind(b.nss.event).unbind(b.nss.alias);n=g.ids;for(var q=n.length;f=n[--q];)if(f===b.id){n.splice(q,1);g.settings[f]=r;break}}};(function(b,g,f,k,e){b.fn[e.name]=b[e.name]=function(){return L.apply(this,[b,g,f,k,e].concat([].slice.call(arguments)))};e.setProperties.call(b[e.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,window,document,void 0);
